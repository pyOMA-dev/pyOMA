

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>PlotMSH &mdash; pyOMA  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> pyOMA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyOMA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>PlotMSH</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for PlotMSH</h1><div class="highlight"><pre>
<span></span><span class="c1"># GUI</span>
<span class="c1"># system i/o</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span>\
    <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QButtonGroup</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QToolButton</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QStyle</span><span class="p">,</span>\
    <span class="n">QTextEdit</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QFrame</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QAction</span><span class="p">,</span> \
    <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QInputDialog</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">,</span> <span class="n">QTableWidget</span><span class="p">,</span>\
    <span class="n">QSpinBox</span><span class="p">,</span> <span class="n">QAbstractItemView</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QTabWidget</span><span class="p">,</span>\
    <span class="n">QSlider</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QIcon</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">pyqtSlot</span><span class="p">,</span> <span class="n">QTimer</span><span class="p">,</span> <span class="n">qInstallMessageHandler</span><span class="p">,</span> <span class="n">QEventLoop</span><span class="p">,</span> <span class="n">QSize</span>
<span class="c1"># Matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">_functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="c1"># check if python is running in headless mode i.e. as a server script</span>
<span class="k">if</span> <span class="s1">&#39;DISPLAY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Qt5Agg&quot;</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span>
<span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="kn">import</span> <span class="n">FigureCanvasBase</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.axes3d</span> <span class="kn">import</span> <span class="n">Axes3D</span><span class="p">,</span> <span class="n">proj3d</span>  <span class="c1"># @UnresolvedImport</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">FancyArrowPatch</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">is_color_like</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> 
<span class="kn">from</span> <span class="nn">matplotlib.markers</span> <span class="kn">import</span> <span class="n">MarkerStyle</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span>


<span class="c1">#make qt application not crash on errors</span>
<div class="viewcode-block" id="my_excepthook"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.my_excepthook">[docs]</a><span class="k">def</span> <span class="nf">my_excepthook</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tback</span><span class="p">):</span>
    <span class="c1"># log the exception here</span>

    <span class="c1"># then call the default handler</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tback</span><span class="p">)</span></div>

<span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">my_excepthook</span>

<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shelve</span>
<span class="c1">#math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">fmod</span>
<span class="c1">#tools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">StabilDiagram</span> <span class="kn">import</span> <span class="n">StabilCalc</span><span class="p">,</span> <span class="n">DelayedDoubleSpinBox</span>
<span class="kn">from</span> <span class="nn">PreprocessingTools</span> <span class="kn">import</span> <span class="n">PreprocessData</span><span class="p">,</span> <span class="n">GeometryProcessor</span>

<span class="n">NoneType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">SSICovRef</span> <span class="kn">import</span> <span class="n">BRSSICovRef</span><span class="p">,</span> <span class="n">PogerSSICovRef</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">BRSSICovRef</span> <span class="o">=</span> <span class="n">NoneType</span>
    <span class="n">PogerSSICovRef</span> <span class="o">=</span> <span class="n">NoneType</span>
<span class="k">try</span><span class="p">:</span>    
    <span class="kn">from</span> <span class="nn">SSIData</span> <span class="kn">import</span> <span class="n">SSIData</span><span class="p">,</span> <span class="n">SSIDataMC</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">SSIData</span> <span class="o">=</span> <span class="n">NoneType</span>
    <span class="n">SSIDataMC</span> <span class="o">=</span> <span class="n">NoneType</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">VarSSIRef</span> <span class="kn">import</span> <span class="n">VarSSIRef</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">VarSSIRef</span> <span class="o">=</span> <span class="n">NoneType</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PRCE</span> <span class="kn">import</span> <span class="n">PRCE</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PRCE</span> <span class="o">=</span> <span class="n">NoneType</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PLSCF</span> <span class="kn">import</span> <span class="n">PLSCF</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PLSCF</span> <span class="o">=</span> <span class="n">NoneType</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ERA</span> <span class="kn">import</span> <span class="n">ERA</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ERA</span> <span class="o">=</span> <span class="n">NoneType</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PostProcessingTools</span> <span class="kn">import</span> <span class="n">MergePoSER</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">MergePoSER</span> <span class="o">=</span> <span class="n">NoneType</span>
<span class="c1">#from pyparsing import line</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">TODO:</span>
<span class="sd">- button for Axes3d.set_axis_off/on</span>
<span class="sd">- implement scale (for correct drawing of axis arrows)</span>
<span class="sd">- use current axes settings when starting the animation </span>
<span class="sd">- rewrite the whole thing properly!!!</span>
<span class="sd">&#39;&#39;&#39;</span>

<div class="viewcode-block" id="nearly_equal"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.nearly_equal">[docs]</a><span class="k">def</span> <span class="nf">nearly_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">sig_fig</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span> <span class="ow">or</span> 
             <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">sig_fig</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">sig_fig</span><span class="p">)</span>
           <span class="p">)</span></div>

<span class="c1"># monkeypatch to allow orthogonal projection in mplot3d</span>
<span class="c1"># breaks automatic placement of axis</span>
<span class="c1"># credit: https://github.com/matplotlib/matplotlib/issues/537</span>
<div class="viewcode-block" id="orthogonal_proj"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.orthogonal_proj">[docs]</a><span class="k">def</span> <span class="nf">orthogonal_proj</span><span class="p">(</span><span class="n">zfront</span><span class="p">,</span> <span class="n">zback</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">+</span> <span class="n">zback</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">-</span> <span class="n">zback</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">*</span> <span class="n">zback</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">-</span> <span class="n">zback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zback</span><span class="p">]])</span></div>

<span class="c1"># copy of mpl_toolkits.mplot3d.proj3d.persp_transformation</span>
<span class="c1"># for restoring the projection in isonometriv view</span>
<div class="viewcode-block" id="persp_transformation"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.persp_transformation">[docs]</a><span class="k">def</span> <span class="nf">persp_transformation</span><span class="p">(</span><span class="n">zfront</span><span class="p">,</span> <span class="n">zback</span><span class="p">):</span>
    <span class="c1">#return orthogonal_proj(zfront, zback)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">+</span> <span class="n">zback</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">-</span> <span class="n">zback</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">*</span> <span class="n">zback</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zfront</span> <span class="o">-</span> <span class="n">zback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="p">])</span></div>
<span class="c1">#monkeypatch draw method to always enforce an aspect ratio of 1 on all axis&#39;</span>
<span class="n">old_draw</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="o">.</span><span class="n">draw</span>
<div class="viewcode-block" id="draw_axes"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.draw_axes">[docs]</a><span class="k">def</span> <span class="nf">draw_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1">#old_draw = self.draw</span>
    <span class="c1">#print(&#39;s&#39;,self)</span>
    <span class="c1">#print(&#39;r&#39;,renderer)</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>
    <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="o">=</span><span class="p">(</span><span class="n">maxx</span><span class="o">-</span><span class="n">minx</span><span class="p">),(</span><span class="n">maxy</span><span class="o">-</span><span class="n">miny</span><span class="p">),(</span><span class="n">maxz</span><span class="o">-</span><span class="n">minz</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="n">dy</span> <span class="ow">or</span> <span class="n">dx</span> <span class="o">!=</span> <span class="n">dz</span><span class="p">:</span>            
        <span class="n">midx</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">minx</span><span class="o">+</span><span class="n">maxx</span><span class="p">)</span>
        <span class="n">midy</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">miny</span><span class="o">+</span><span class="n">maxy</span><span class="p">)</span>
        <span class="n">midz</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">minz</span><span class="o">+</span><span class="n">maxz</span><span class="p">)</span>
    
        <span class="n">hrange</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="c1">#print(midx, midy,midz, hrange)</span>
        <span class="c1">#print(type(midx), type(midy),type(midz), type(hrange))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="n">midx</span><span class="o">-</span><span class="n">hrange</span> <span class="p">,</span> <span class="n">midx</span><span class="o">+</span><span class="n">hrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="n">midy</span><span class="o">-</span><span class="n">hrange</span> <span class="p">,</span> <span class="n">midy</span><span class="o">+</span><span class="n">hrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">midz</span><span class="o">-</span><span class="n">hrange</span> <span class="p">,</span> <span class="n">midz</span><span class="o">+</span><span class="n">hrange</span><span class="p">)</span>
    <span class="n">old_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span></div>
<span class="c1">#Axes3D.draw = draw_axes</span>
<span class="n">old_resize_event</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">FigureCanvasQTAgg</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">)</span>

<div class="viewcode-block" id="resizeEvent_"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.resizeEvent_">[docs]</a><span class="k">def</span> <span class="nf">resizeEvent_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
    <span class="n">dpival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
    <span class="n">winch</span><span class="p">,</span> <span class="n">hinch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">winch</span><span class="o">/</span><span class="n">hinch</span>
    <span class="k">if</span> <span class="n">w</span><span class="o">/</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="n">aspect</span><span class="p">:</span>               
        <span class="n">h</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="n">aspect</span>
    <span class="k">else</span><span class="p">:</span>               
        <span class="n">w</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span><span class="n">aspect</span>
    <span class="n">winch</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="n">dpival</span>
    <span class="n">hinch</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">dpival</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">winch</span><span class="p">,</span> <span class="n">hinch</span><span class="p">)</span>
    <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">resize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span> 
    <span class="n">QWidget</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="ModeShapePlot"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot">[docs]</a><span class="k">class</span> <span class="nc">ModeShapePlot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is used for displaying modal values and modeshapes obtained</span>
<span class="sd">    by the SSICovRef class by Mihai-Andrei Udrea 2013 </span>
<span class="sd">    (Bauhaus-Universität Weimar, Institut für Strukturmechanik). An</span>
<span class="sd">    interactive GUI based on PyQt5 is used to create such plots.</span>

<span class="sd">    Abilities include:</span>

<span class="sd">    Drawing:</span>
<span class="sd">    - creation of 3d plots using matplotlib&#39;s mplot3 from the </span>
<span class="sd">        matplotlib toolkit</span>
<span class="sd">    - adjusting axis limits for each of the three axis</span>
<span class="sd">        i.e. zoom view, shift view (along single and multiple axis&#39;)</span>
<span class="sd">    - change the viewport e.g. x, y, z and isometric view</span>
<span class="sd">    - rotating and zooming through mouse interaction is currently </span>
<span class="sd">        supported by matplotlib, whereas panning is not</span>
<span class="sd">    - animate the currently displayed deformed structure</span>
<span class="sd">    - save the still frame</span>

<span class="sd">    currently __not__ supported:</span>
<span class="sd">    - 3D surface plots, as they are not properly supported by the </span>
<span class="sd">        underlying matplotlib api</span>
<span class="sd">    - combination of several modeshapes or sensor setups </span>
<span class="sd">        (this could be done easily in an external script)</span>
<span class="sd">    - saving of the animation as a movie file</span>
<span class="sd">    - drawing multiple modeshapes into one plot</span>
<span class="sd">    - plot modeshape in a single call from a script i.e. use static methods</span>
<span class="sd">    </span>
<span class="sd">                | Merging Routine</span>
<span class="sd">Variable in     | single-setup  poger/preger  poser merging</span>
<span class="sd">PlotMSH         |</span>
<span class="sd">________________|____________________________________________</span>
<span class="sd">modal_freq.     | modal_data    modal_data    merged_data</span>
<span class="sd">modal_damping   | modal_data    modal_data    merged_data</span>
<span class="sd">modeshapes      | modal_data    modal_data    merged_data</span>
<span class="sd">                |</span>
<span class="sd">num_channels    | prep_data     modal_data    merged_data</span>
<span class="sd">                |</span>
<span class="sd">chan_dofs       | prep_data     modal_data    merged_data</span>
<span class="sd">                |    </span>
<span class="sd">select_modes    | stabil_data   stabil_data   merged_data</span>
<span class="sd">                |</span>
<span class="sd">nodes           | geometry_data geometry_data geometry_data</span>
<span class="sd">lines           | geometry_data geometry_data geometry_data</span>
<span class="sd">master-slaves   | geometry_data geometry_data geometry_data </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># define this class&#39;s signals and the types of data they emit</span>
    <span class="n">grid_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">beams_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">slaves_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">chan_dofs_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">geometry_data</span><span class="p">,</span>
                 <span class="n">stabil_calc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">modal_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">prep_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">merged_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">selected_mode</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">amplitude</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">real</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1">#0.1*10^x [m] where x=scale</span>
                 <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">nodecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                 <span class="n">nodemarker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                 <span class="n">nodesize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">beamcolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                 <span class="n">beamstyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                 <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">callback_fun</span><span class="o">=</span><span class="kc">None</span>
                 <span class="p">):</span>
        <span class="c1">#print(callback_fun)</span>
        <span class="c1">#assert merged_data is not None or (prep_data is not None and modal_data is not None and stabil_calc is not None) or isinstance(modal_data, PogerSSICovRef)</span>
        
        <span class="k">if</span> <span class="n">stabil_calc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&#39;stabil_calc = &#39;, stabil_calc)</span>
            <span class="c1">#print(&#39;StabilCalc = &#39;, StabilCalc)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stabil_calc</span><span class="p">,</span> <span class="n">StabilCalc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stabil_calc</span> <span class="o">=</span> <span class="n">stabil_calc</span>
        

        
        <span class="c1">#modal_data = modal_data</span>
        <span class="k">if</span> <span class="n">modal_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modal_data</span><span class="p">,</span> <span class="p">(</span><span class="n">BRSSICovRef</span><span class="p">,</span> <span class="n">SSIData</span><span class="p">,</span><span class="n">SSIDataMC</span><span class="p">,</span><span class="n">VarSSIRef</span><span class="p">,</span> <span class="n">PRCE</span><span class="p">,</span> <span class="n">PLSCF</span><span class="p">,</span> <span class="n">PogerSSICovRef</span><span class="p">,</span> <span class="n">ERA</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_data</span> <span class="o">=</span> <span class="n">modal_data</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry_data</span><span class="p">,</span> <span class="n">GeometryProcessor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span> <span class="o">=</span> <span class="n">geometry_data</span>
        
        <span class="c1">#prep_data = prep_data</span>
        <span class="k">if</span> <span class="n">prep_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prep_data</span><span class="p">,</span> <span class="n">PreprocessData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span> <span class="o">=</span> <span class="n">prep_data</span>
        
        <span class="k">if</span> <span class="n">merged_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">MergePoSER</span><span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">merged_data</span>
        
        <span class="k">if</span> <span class="n">merged_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">merged_chan_dofs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">merged_num_channels</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">mean_frequencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">mean_damping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">merged_mode_shapes</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">std_frequencies</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">std_frequencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">std_damping</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">std_damping</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span><span class="p">)),[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span><span class="p">)))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_name</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">setup_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">start_time</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modal_data</span><span class="p">,</span> <span class="n">PogerSSICovRef</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">merged_chan_dofs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">merged_num_channels</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">modal_frequencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">modal_damping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">mode_shapes</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span> <span class="o">=</span> <span class="n">stabil_calc</span><span class="o">.</span><span class="n">select_modes</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_name</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">setup_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">start_time</span>
            
        <span class="k">elif</span> <span class="n">prep_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span> <span class="o">=</span> <span class="n">prep_data</span><span class="o">.</span><span class="n">chan_dofs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="n">prep_data</span><span class="o">.</span><span class="n">num_analised_channels</span>
            
            <span class="k">if</span> <span class="n">modal_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">modal_frequencies</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">modal_damping</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">mode_shapes</span>
                
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modal_data</span><span class="p">,</span> <span class="n">VarSSIRef</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">std_frequencies</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">std_frequencies</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">std_damping</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">std_damping</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">std_frequencies</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">std_damping</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[]]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">std_frequencies</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">std_damping</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="k">if</span> <span class="n">stabil_calc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span> <span class="o">=</span> <span class="n">stabil_calc</span><span class="o">.</span><span class="n">select_modes</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">setup_name</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">setup_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">modal_data</span><span class="o">.</span><span class="n">start_time</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[]]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#if not geometry_data:</span>
        <span class="c1">#geometry_data = prep_data.geometry_data          </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">}</span>
        
        <span class="c1"># linestyles available in matplotlib</span>
        <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        
        <span class="c1">#markerstylesavailable in matplotlib</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">MarkerStyle</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">real</span>  
             
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="k">assert</span> <span class="n">is_color_like</span><span class="p">(</span><span class="n">beamcolor</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">beamcolor</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span> <span class="o">=</span> <span class="n">beamcolor</span>

        <span class="k">assert</span> <span class="n">beamstyle</span> <span class="ow">in</span> <span class="n">styles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span> <span class="o">=</span> <span class="n">beamstyle</span>

        <span class="k">assert</span> <span class="n">is_color_like</span><span class="p">(</span><span class="n">nodecolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodecolor</span> <span class="o">=</span> <span class="n">nodecolor</span>

        <span class="k">assert</span> <span class="n">nodemarker</span> <span class="ow">in</span> <span class="n">markers</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nodemarker</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodemarker</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodemarker</span> <span class="o">=</span> <span class="n">nodemarker</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodesize</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodesize</span> <span class="o">=</span> <span class="n">nodesize</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>
        
        <span class="k">if</span> <span class="n">callback_fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">callback_fun</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_fun</span> <span class="o">=</span> <span class="n">callback_fun</span>

        <span class="c1">#bool objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_master_slaves</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_chan_dofs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_trace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_ani</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># plot objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># mpl 1.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># mpl 1.3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">Axes3D</span><span class="o">.</span><span class="n">draw</span> <span class="o">=</span> <span class="n">draw_axes</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
        <span class="c1">#instantiate the x,y,z axis arrows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_axis</span><span class="p">()</span>
    
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.reset_view"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.reset_view">[docs]</a>    <span class="k">def</span> <span class="nf">reset_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        restore viewport, </span>
<span class="sd">        restore axis&#39; limits, </span>
<span class="sd">        reset displacements values for all nodes, </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="n">proj3d</span><span class="o">.</span><span class="n">persp_transformation</span> <span class="o">=</span> <span class="n">persp_transformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xmin</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xmax</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ymax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ymax</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">zmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">zmin</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">zmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">xmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xmax</span><span class="p">)</span>
            <span class="n">ymin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ymin</span><span class="p">)</span>
            <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ymax</span><span class="p">)</span>
            <span class="n">zmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">zmin</span><span class="p">)</span>
            <span class="n">zmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">zmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">)</span>    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_nodes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_chan_dofs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_master_slaves</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_msh</span><span class="p">()</span>
        
        <span class="c1">#self.disp_nodes = { i : [0,0,0] for i in self.geometry_data.nodes.keys() }</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        

    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.change_viewport"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.change_viewport">[docs]</a>    <span class="k">def</span> <span class="nf">change_viewport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change the viewport</span>
<span class="sd">        works in combination with the appropriate buttons as senders or</span>
<span class="sd">        by passing one of [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;ISO&#39;]</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
            
        <span class="k">if</span> <span class="n">viewport</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="c1">#proj3d.persp_transformation = orthogonal_proj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">viewport</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">0</span>
            <span class="c1">#proj3d.persp_transformation = orthogonal_proj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">viewport</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
            <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span>
            <span class="c1">#proj3d.persp_transformation = orthogonal_proj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">viewport</span> <span class="o">==</span> <span class="s1">&#39;ISO&#39;</span><span class="p">:</span>
            <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span>
            <span class="c1">#proj3d.persp_transformation = persp_transformation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;persp&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;viewport not recognized: &#39;</span><span class="p">,</span> <span class="n">viewport</span><span class="p">)</span>
            <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span>
            <span class="c1">#proj3d.persp_transformation = persp_transformation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;persp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="p">,</span> <span class="n">azim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">_setup_blit</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(str)</span>
<div class="viewcode-block" id="ModeShapePlot.change_mode"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.change_mode">[docs]</a>    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if user selects a new mode,</span>
<span class="sd">        extract the mode number from the passed string (contains frequency...)</span>
<span class="sd">        write modal values to the infobox</span>
<span class="sd">        and plot the mode shape</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># mode numbering starts at 1 python lists start at 0</span>
        <span class="n">selected_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>       
            <span class="n">frequencies</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">])</span>     
            <span class="n">f_delta</span><span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">frequencies</span><span class="o">-</span><span class="n">frequency</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">f_delta</span><span class="p">)</span>
        <span class="c1">#print(selected_indices)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode_index</span> <span class="o">=</span> <span class="n">selected_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No arguments provided!&#39;</span><span class="p">)</span>
        <span class="c1">#print(mode_index)</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span><span class="p">[</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">damping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_damping</span><span class="p">[</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stabil_calc</span><span class="p">:</span>
            <span class="n">MPC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stabil_calc</span><span class="o">.</span><span class="n">MPC_matrix</span><span class="p">[</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">MP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stabil_calc</span><span class="o">.</span><span class="n">MP_matrix</span><span class="p">[</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">MPD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stabil_calc</span><span class="o">.</span><span class="n">MPD_matrix</span><span class="p">[</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MPC</span><span class="o">=</span><span class="kc">None</span>
            <span class="n">MP</span><span class="o">=</span><span class="kc">None</span>
            <span class="n">MPD</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span> <span class="o">=</span> <span class="n">mode_index</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_ani</span><span class="p">:</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">cwd</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_msh</span><span class="p">()</span>

        <span class="c1">#print(&#39;self.callback_fun&#39;, self.callback_fun)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&#39;call&#39;)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callback_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">damping</span><span class="p">,</span> <span class="n">MPC</span><span class="p">,</span> <span class="n">MP</span><span class="p">,</span> <span class="n">MPD</span> <span class="c1">#order, mode_num,....</span></div>

<div class="viewcode-block" id="ModeShapePlot.get_frequencies"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.get_frequencies">[docs]</a>    <span class="k">def</span> <span class="nf">get_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span>
        
        <span class="n">frequencies</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_frequencies</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">]</span>
        <span class="n">frequencies</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">frequencies</span></div>
    
    <span class="c1">#@pyqtSlot()</span>
    <span class="c1">#@pyqtSlot(float)</span>
<div class="viewcode-block" id="ModeShapePlot.change_amplitude"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.change_amplitude">[docs]</a>    <span class="k">def</span> <span class="nf">change_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        changes the amplitude</span>
<span class="sd">        amplitude either gets passed or will be read from the widget</span>
<span class="sd">        redraw the modeshapes based on this amplitude</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">:</span><span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_msh</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(bool)</span>
<div class="viewcode-block" id="ModeShapePlot.change_part"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.change_part">[docs]</a>    <span class="k">def</span> <span class="nf">change_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change, which part of the complex number modeshapes should be </span>
<span class="sd">        drawn, set the pointer variable based on which widget sent the signal</span>
<span class="sd">        redraw the modeshapes </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">:</span> <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_msh</span><span class="p">()</span></div>
        

<div class="viewcode-block" id="ModeShapePlot.save_plot"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.save_plot">[docs]</a>    <span class="k">def</span> <span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        save the curently displayed frame as a *.png graphics file</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div>
            
            
    <span class="c1">#@pyqtSlot(float, float, float, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_node"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        receive a node from a signal</span>
<span class="sd">        add zero-value displacements for this node to the internal displacements table</span>
<span class="sd">        draw a single point at coordinates</span>
<span class="sd">        draw the number of the node</span>
<span class="sd">        store the two plot objects in a table</span>
<span class="sd">        remove any objects that might be in the table at the desired place</span>
<span class="sd">        to avoid duplicate nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># leave present value if there is any else put 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>        

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># draw displaced nodes</span>
        
        <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodecolor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodemarker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodesize</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(tuple, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_line"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        receive a line coordinates from a signal</span>
<span class="sd">        add the start node and end node to the internal line table</span>
<span class="sd">        draw a line between the tow nodes</span>
<span class="sd">        store the line object in a table</span>
<span class="sd">        remove any objects that might be in the table at the desired place</span>
<span class="sd">        i.e. avoid duplicate lines</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">beamstyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beamstyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span>

        <span class="n">line_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">beamcolor</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">beamstyle</span><span class="p">,</span>  <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1">#del self.lines_objects[i]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_object</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
    <span class="c1">#@pyqtSlot(tuple, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_nd_line"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_nd_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_nd_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span>

        <span class="n">beamstyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span>
        
        <span class="n">line_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">beamcolor</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">beamstyle</span><span class="p">,</span>  <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1">#del self.nd_lines_objects[i]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_object</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span> </div>
           
    <span class="c1">#@pyqtSlot(tuple, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_cn_line"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_cn_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_cn_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">beamcolor</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>

        <span class="n">beamstyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">disp_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="n">line_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">beamcolor</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">beamstyle</span><span class="p">,</span>  <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_object</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>   </div>
     
        
    <span class="c1">#@pyqtSlot(int, float, float, float, int, float, float, float, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_master_slave"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_master_slave">[docs]</a>    <span class="k">def</span> <span class="nf">add_master_slave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        receive master-slave definitions from a signal</span>
<span class="sd">        add these definitions to the internal master-slave table</span>
<span class="sd">        draw an arrow indicating the DOF at each node of master and slave</span>
<span class="sd">            as a specialty arrows at equal positions and direction will </span>
<span class="sd">            be offset to avoid overlapping</span>
<span class="sd">        arrow length&#39;s do not scale with the total dimensions of the plot</span>
<span class="sd">        store the two arrow objects in a table</span>
<span class="sd">        remove any objects that might be in the table at the desired place</span>
<span class="sd">        i.e. avoid duplicate arrows</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">offset_arrows</span><span class="p">(</span><span class="n">verts3d_new</span><span class="p">,</span> <span class="n">all_arrows_list</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            avoid overlapping arrows as they are hard to distinguish</span>
<span class="sd">            therefore loop through all arrow object and compare their</span>
<span class="sd">            coordinates and directions (but ignore length) with the </span>
<span class="sd">            arrow to be newly created if there is an overlapping then</span>
<span class="sd">            offset the coordinates of the new arrow by 5 % of the </span>
<span class="sd">            length (hardcoded) in each direction (which should actually</span>
<span class="sd">            only be in the perpendicular plane)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_e</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_e</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_e</span><span class="p">))</span> <span class="o">=</span> <span class="n">verts3d_new</span>
            <span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">x_e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_e</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">dir_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span> <span class="n">y_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span> <span class="n">z_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">arrow</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">all_arrows_list</span><span class="p">):</span>
                    <span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">x_b</span><span class="p">),</span> <span class="p">(</span><span class="n">y_a</span><span class="p">,</span> <span class="n">y_b</span><span class="p">),</span> <span class="p">(</span><span class="n">z_a</span><span class="p">,</span> <span class="n">z_b</span><span class="p">)</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">_verts3d</span>
                    <span class="c1"># transform from position vector to direction vector</span>
                    <span class="n">x_c</span><span class="p">,</span> <span class="n">y_c</span><span class="p">,</span> <span class="n">z_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_b</span> <span class="o">-</span> <span class="n">x_a</span><span class="p">),</span> <span class="p">(</span><span class="n">y_b</span> <span class="o">-</span> <span class="n">y_a</span><span class="p">),</span> <span class="p">(</span><span class="n">z_b</span> <span class="o">-</span> <span class="n">z_a</span><span class="p">)</span>
                    <span class="n">this_start_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span><span class="p">,</span> <span class="n">z_b</span><span class="p">)</span>
                    <span class="n">this_length</span> <span class="o">=</span> <span class="n">x_c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_c</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="k">if</span> <span class="n">this_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">this_dir_norm</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">x_c</span> <span class="o">/</span> <span class="n">this_length</span><span class="p">,</span> <span class="n">y_c</span> <span class="o">/</span> <span class="n">this_length</span><span class="p">,</span> <span class="n">z_c</span> <span class="o">/</span> <span class="n">this_length</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">start_point</span> <span class="o">!=</span> <span class="n">this_start_point</span><span class="p">:</span>  <span class="c1"># starting point equal</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">this_dir_norm</span> <span class="o">!=</span> <span class="n">dir_norm</span><span class="p">:</span>  <span class="c1"># direction equal</span>
                        <span class="k">continue</span>
                    <span class="c1"># offset hardcoded</span>
                    <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">coord</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">this_length</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">start_point</span><span class="p">]</span>
                    <span class="c1"># lazy offset, it should actually be in the plane</span>
                    <span class="c1"># perpendicular to the vector</span>
                    <span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span><span class="p">)</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="n">x_e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_e</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="n">dir_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span> <span class="n">y_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span> <span class="n">z_e</span> <span class="o">/</span> <span class="n">length</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_e</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_e</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_e</span><span class="p">))</span>


        <span class="c1">#self.undraw_lines()  # do not show beams, as they are distracting</span>
        <span class="c1">#self.undraw_chan_dofs()</span>

        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;bgrcmyk&quot;</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">fmod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">7</span><span class="p">))]</span>  <span class="c1"># equal colors for both arrows</span>

        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">]</span>
        <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_m</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_m</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_m</span><span class="p">))</span> <span class="o">=</span> <span class="n">offset_arrows</span><span class="p">(</span>
            <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_m</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_m</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_m</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">)</span>

        <span class="c1"># point the arrow towards the resulting direction</span>
        <span class="n">arrow_m</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">([</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">x_m</span><span class="p">],</span> <span class="p">[</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">y_m</span><span class="p">],</span> <span class="p">[</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">z_m</span><span class="p">],</span>
                          <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_master_slaves</span><span class="p">)</span>
        <span class="n">arrow_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arrow_m</span><span class="p">)</span>

        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">]</span>
        <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">))</span> <span class="o">=</span> <span class="n">offset_arrows</span><span class="p">(</span>
            <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">)</span>

        <span class="c1"># point the arrow towards the resulting direction</span>
        <span class="n">arrow_sl</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">([</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">x_sl</span><span class="p">],</span> <span class="p">[</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">y_sl</span><span class="p">],</span> <span class="p">[</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">z_sl</span><span class="p">],</span>
                           <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_master_slaves</span><span class="p">)</span>
        
        <span class="n">arrow_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arrow_sl</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">arrow_m</span><span class="p">,</span> <span class="n">arrow_sl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapePlot.calc_xyz"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.calc_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">calc_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">az</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You forgot to convert to radians &#39;</span><span class="p">,</span><span class="n">az</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You forgot to convert to radians &#39;</span><span class="p">,</span> <span class="n">elev</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span> <span class="c1"># for elevation angle defined from XY-plane up</span>
        <span class="c1">#x=r*np.sin(elev)*np.cos(az) # for elevation angle defined from Z-axis down</span>
        <span class="n">y</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span> <span class="c1"># for elevation angle defined from XY-plane up</span>
        <span class="c1">#y=r*np.sin(elev)*np.sin(az)# for elevation angle defined from Z-axis down</span>
        <span class="n">z</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span><span class="c1"># for elevation angle defined from XY-plane up</span>
        <span class="c1">#z=r*np.cos(elev)# for elevation angle defined from Z-axis down</span>
        
        <span class="c1">#correct numerical noise</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="n">a</span><span class="o">*=</span><span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span></div>
    
    <span class="c1">#@pyqtSlot(int, int, tuple, int)</span>
<div class="viewcode-block" id="ModeShapePlot.add_chan_dof"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.add_chan_dof">[docs]</a>    <span class="k">def</span> <span class="nf">add_chan_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">chan_name</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draw an arrow indicating the DOF </span>
<span class="sd">        arrow lengths do not scale with the total dimension of the plot</span>
<span class="sd">        add the channel number to the arrow</span>
<span class="sd">        store the two objects in a table</span>
<span class="sd">        remove any objects that might be in the table at the desired place</span>
<span class="sd">        i.e. avoid duplicate arrows/texts</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        
        <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_xyz</span><span class="p">(</span><span class="n">az</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">elev</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        
        <span class="c1">#print(chan_name, node, x_m,y_m,z_m)</span>
        

        <span class="c1"># point the arrow towards the resulting direction</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">([</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">x_m</span><span class="p">],</span> <span class="p">[</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">y_m</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">z_m</span><span class="p">],</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_chan_dofs</span><span class="p">)</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">arrow</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_s</span> <span class="o">+</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">chan_name</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_chan_dofs</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">arrow</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(float, float, float, int)</span>
<div class="viewcode-block" id="ModeShapePlot.take_node"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.take_node">[docs]</a>    <span class="k">def</span> <span class="nf">take_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        take a node at coordinates received by a signal</span>
<span class="sd">        take any objects connected to this node first (there should not be any)</span>
<span class="sd">        remove the patch objects from the plot</span>
<span class="sd">        remove the coordinates from the node and displacement tables</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">d_x</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">d_x</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d_x</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d_y</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d_z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">),</span> <span class="n">node</span><span class="p">))):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># ._offsets3d = ([x],[y],np.ndarray([z]))</span>
            <span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">,</span> <span class="n">z_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_offsets3d</span><span class="p">]</span>
            <span class="k">if</span>   <span class="n">x</span> <span class="o">-</span> <span class="n">d_x</span> <span class="o">&lt;=</span> <span class="n">x_</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">d_x</span> <span class="ow">and</span> \
                    <span class="n">y</span> <span class="o">-</span> <span class="n">d_y</span> <span class="o">&lt;=</span> <span class="n">y_</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">d_y</span> <span class="ow">and</span> \
                    <span class="n">z</span> <span class="o">-</span> <span class="n">d_z</span> <span class="o">&lt;=</span> <span class="n">z_</span> <span class="o">&lt;=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">d_z</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># executed when for loop runs through</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;patches_object not found&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="n">node</span><span class="p">))):</span>

            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]:</span>           
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># executed when for loop runs through</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;node not found&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(tuple)</span>
<div class="viewcode-block" id="ModeShapePlot.take_line"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.take_line">[docs]</a>    <span class="k">def</span> <span class="nf">take_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove a line between to node received by a signal</span>
<span class="sd">        if the plot objects are already in there displaced state</span>
<span class="sd">        the comparison between the actual coordinates and these</span>
<span class="sd">        objects have to account for this by comparing to an interval</span>
<span class="sd">        of coordinates</span>
<span class="sd">        remove the line nodes from the internal table, too</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">node_s</span><span class="p">,</span> <span class="n">node_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="n">node_s</span>
        <span class="n">x_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="n">z_e</span> <span class="o">=</span> <span class="n">node_e</span>
        
        <span class="n">d_node_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">d_node_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="n">d_x_s</span><span class="p">,</span> <span class="n">d_y_s</span><span class="p">,</span> <span class="n">d_z_s</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d_node_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">d_node_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">d_node_s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">d_x_e</span><span class="p">,</span> <span class="n">d_y_e</span><span class="p">,</span> <span class="n">d_z_e</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d_node_e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">d_node_e</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">d_node_e</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">x_s_</span><span class="p">,</span> <span class="n">x_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s_</span><span class="p">,</span> <span class="n">y_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s_</span><span class="p">,</span> <span class="n">z_e_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span>
                <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">_verts3d</span>
            <span class="k">if</span>  <span class="n">x_s</span> <span class="o">-</span> <span class="n">d_x_s</span> <span class="o">&lt;=</span> <span class="n">x_s_</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">d_x_s</span> <span class="ow">and</span> \
                    <span class="n">x_e</span> <span class="o">-</span> <span class="n">d_x_e</span> <span class="o">&lt;=</span> <span class="n">x_e_</span> <span class="o">&lt;=</span> <span class="n">x_e</span> <span class="o">+</span> <span class="n">d_x_e</span> <span class="ow">and</span> \
                    <span class="n">y_s</span> <span class="o">-</span> <span class="n">d_y_s</span> <span class="o">&lt;=</span> <span class="n">y_s_</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">d_y_s</span> <span class="ow">and</span> \
                    <span class="n">y_e</span> <span class="o">-</span> <span class="n">d_y_e</span> <span class="o">&lt;=</span> <span class="n">y_e_</span> <span class="o">&lt;=</span> <span class="n">y_e</span> <span class="o">+</span> <span class="n">d_y_e</span> <span class="ow">and</span> \
                    <span class="n">z_s</span> <span class="o">-</span> <span class="n">d_z_s</span> <span class="o">&lt;=</span> <span class="n">z_s_</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">d_z_s</span> <span class="ow">and</span> \
                    <span class="n">z_e</span> <span class="o">-</span> <span class="n">d_z_e</span> <span class="o">&lt;=</span> <span class="n">z_e_</span> <span class="o">&lt;=</span> <span class="n">z_e</span> <span class="o">+</span> <span class="n">d_z_e</span><span class="p">:</span>  <span class="c1"># account for displaced lines</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">x_s</span> <span class="o">-</span> <span class="n">d_x_s</span> <span class="o">&lt;=</span> <span class="n">x_e_</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">d_x_s</span> <span class="ow">and</span> \
                    <span class="n">x_e</span> <span class="o">-</span> <span class="n">d_x_e</span> <span class="o">&lt;=</span> <span class="n">x_s_</span> <span class="o">&lt;=</span> <span class="n">x_e</span> <span class="o">+</span> <span class="n">d_x_e</span> <span class="ow">and</span> \
                    <span class="n">y_s</span> <span class="o">-</span> <span class="n">d_y_s</span> <span class="o">&lt;=</span> <span class="n">y_e_</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">d_y_s</span> <span class="ow">and</span> \
                    <span class="n">y_e</span> <span class="o">-</span> <span class="n">d_y_e</span> <span class="o">&lt;=</span> <span class="n">y_s_</span> <span class="o">&lt;=</span> <span class="n">y_e</span> <span class="o">+</span> <span class="n">d_y_e</span> <span class="ow">and</span> \
                    <span class="n">z_s</span> <span class="o">-</span> <span class="n">d_z_s</span> <span class="o">&lt;=</span> <span class="n">z_e_</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">d_z_s</span> <span class="ow">and</span> \
                    <span class="n">z_e</span> <span class="o">-</span> <span class="n">d_z_e</span> <span class="o">&lt;=</span> <span class="n">z_s_</span> <span class="o">&lt;=</span> <span class="n">z_e</span> <span class="o">+</span> <span class="n">d_z_e</span><span class="p">:</span>  <span class="c1"># account for inverted lines</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;line_object not found&#39;</span><span class="p">)</span>
                
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">x_s_</span><span class="p">,</span> <span class="n">x_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s_</span><span class="p">,</span> <span class="n">y_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s_</span><span class="p">,</span> <span class="n">z_e_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span>
                <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">_verts3d</span>
            <span class="k">if</span>  <span class="n">x_s</span> <span class="o">-</span> <span class="n">d_x_s</span> <span class="o">&lt;=</span> <span class="n">x_s_</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">d_x_s</span> <span class="ow">and</span> \
                    <span class="n">x_e</span> <span class="o">-</span> <span class="n">d_x_e</span> <span class="o">&lt;=</span> <span class="n">x_e_</span> <span class="o">&lt;=</span> <span class="n">x_e</span> <span class="o">+</span> <span class="n">d_x_e</span> <span class="ow">and</span> \
                    <span class="n">y_s</span> <span class="o">-</span> <span class="n">d_y_s</span> <span class="o">&lt;=</span> <span class="n">y_s_</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">d_y_s</span> <span class="ow">and</span> \
                    <span class="n">y_e</span> <span class="o">-</span> <span class="n">d_y_e</span> <span class="o">&lt;=</span> <span class="n">y_e_</span> <span class="o">&lt;=</span> <span class="n">y_e</span> <span class="o">+</span> <span class="n">d_y_e</span> <span class="ow">and</span> \
                    <span class="n">z_s</span> <span class="o">-</span> <span class="n">d_z_s</span> <span class="o">&lt;=</span> <span class="n">z_s_</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">d_z_s</span> <span class="ow">and</span> \
                    <span class="n">z_e</span> <span class="o">-</span> <span class="n">d_z_e</span> <span class="o">&lt;=</span> <span class="n">z_e_</span> <span class="o">&lt;=</span> <span class="n">z_e</span> <span class="o">+</span> <span class="n">d_z_e</span><span class="p">:</span>  <span class="c1"># account for displaced lines</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">x_s</span> <span class="o">-</span> <span class="n">d_x_s</span> <span class="o">&lt;=</span> <span class="n">x_e_</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="n">d_x_s</span> <span class="ow">and</span> \
                    <span class="n">x_e</span> <span class="o">-</span> <span class="n">d_x_e</span> <span class="o">&lt;=</span> <span class="n">x_s_</span> <span class="o">&lt;=</span> <span class="n">x_e</span> <span class="o">+</span> <span class="n">d_x_e</span> <span class="ow">and</span> \
                    <span class="n">y_s</span> <span class="o">-</span> <span class="n">d_y_s</span> <span class="o">&lt;=</span> <span class="n">y_e_</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="n">d_y_s</span> <span class="ow">and</span> \
                    <span class="n">y_e</span> <span class="o">-</span> <span class="n">d_y_e</span> <span class="o">&lt;=</span> <span class="n">y_s_</span> <span class="o">&lt;=</span> <span class="n">y_e</span> <span class="o">+</span> <span class="n">d_y_e</span> <span class="ow">and</span> \
                    <span class="n">z_s</span> <span class="o">-</span> <span class="n">d_z_s</span> <span class="o">&lt;=</span> <span class="n">z_e_</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="n">d_z_s</span> <span class="ow">and</span> \
                    <span class="n">z_e</span> <span class="o">-</span> <span class="n">d_z_e</span> <span class="o">&lt;=</span> <span class="n">z_s_</span> <span class="o">&lt;=</span> <span class="n">z_e</span> <span class="o">+</span> <span class="n">d_z_e</span><span class="p">:</span>  <span class="c1"># account for inverted lines</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;line_object not found&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(int, float, float, float, int, float, float, float)</span>
<div class="viewcode-block" id="ModeShapePlot.take_master_slave"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.take_master_slave">[docs]</a>    <span class="k">def</span> <span class="nf">take_master_slave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove the two arrows associated with the master-slave definition</span>
<span class="sd">        received by a signal</span>
<span class="sd">        remove the master-slave definition from the internal table, too</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">arrow_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">)</span>
        <span class="n">arrow_sl</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">)</span>

        <span class="n">node_m</span> <span class="o">=</span> <span class="n">arrow_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_s_m</span><span class="p">,</span> <span class="n">y_s_m</span><span class="p">,</span> <span class="n">z_s_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_m</span><span class="p">]</span>
        <span class="n">x_e_m</span><span class="p">,</span> <span class="n">y_e_m</span><span class="p">,</span> <span class="n">z_e_m</span> <span class="o">=</span> <span class="n">arrow_m</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">length_m</span> <span class="o">=</span> <span class="n">x_e_m</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_e_m</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_e_m</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">node_sl</span> <span class="o">=</span> <span class="n">arrow_sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_s_sl</span><span class="p">,</span> <span class="n">y_s_sl</span><span class="p">,</span> <span class="n">z_s_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_sl</span><span class="p">]</span>
        
        <span class="n">x_e_sl</span><span class="p">,</span> <span class="n">y_e_sl</span><span class="p">,</span> <span class="n">z_e_sl</span> <span class="o">=</span> <span class="n">arrow_sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">length_sl</span> <span class="o">=</span> <span class="n">x_e_sl</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_e_sl</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_e_sl</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">)):</span>
            <span class="n">arrow_found</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">arrow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="p">(</span><span class="n">x_s</span><span class="p">,</span> <span class="n">x_e</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s</span><span class="p">,</span> <span class="n">y_e</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s</span><span class="p">,</span> <span class="n">z_e</span><span class="p">)</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">_verts3d</span>
                <span class="c1"># transform from position vector to direction vector</span>
                <span class="n">x_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="n">z_e</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_e</span> <span class="o">-</span> <span class="n">x_s</span><span class="p">),</span> <span class="p">(</span><span class="n">y_e</span> <span class="o">-</span> <span class="n">y_s</span><span class="p">),</span> <span class="p">(</span><span class="n">z_e</span> <span class="o">-</span> <span class="n">z_s</span><span class="p">)</span>

                <span class="c1"># check positions with offsets and directions</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="o">&lt;=</span> <span class="n">x_s_m</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="ow">and</span>
                    <span class="n">y_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="o">&lt;=</span> <span class="n">y_s_m</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="ow">and</span>
                    <span class="n">z_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="o">&lt;=</span> <span class="n">z_s_m</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_m</span> <span class="ow">and</span>
                    <span class="n">x_e</span> <span class="o">==</span> <span class="n">x_e_m</span> <span class="ow">and</span>
                    <span class="n">y_e</span> <span class="o">==</span> <span class="n">y_e_m</span> <span class="ow">and</span>
                    <span class="n">z_e</span> <span class="o">==</span> <span class="n">z_e_m</span><span class="p">):</span>
                    <span class="n">arrow_found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">x_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="o">&lt;=</span> <span class="n">x_s_sl</span> <span class="o">&lt;=</span> <span class="n">x_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="ow">and</span>
                    <span class="n">y_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="o">&lt;=</span> <span class="n">y_s_sl</span> <span class="o">&lt;=</span> <span class="n">y_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="ow">and</span>
                    <span class="n">z_s</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="o">&lt;=</span> <span class="n">z_s_sl</span> <span class="o">&lt;=</span> <span class="n">z_s</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length_sl</span> <span class="ow">and</span>
                    <span class="n">x_e</span> <span class="o">==</span> <span class="n">x_e_sl</span> <span class="ow">and</span>
                    <span class="n">y_e</span> <span class="o">==</span> <span class="n">y_e_sl</span> <span class="ow">and</span>
                    <span class="n">z_e</span> <span class="o">==</span> <span class="n">z_e_sl</span><span class="p">):</span>
                    <span class="n">arrow_found</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># ie found the right master slave pair</span>
            <span class="k">if</span> <span class="n">arrow_found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">arrow_found</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># remove both master slave arrows</span>
                <span class="k">for</span> <span class="n">arrow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">arrow</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1"># restart the first for loop i.e. start j at 0 again</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arrows_object not found&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot(int, int, tuple, int)</span>
<div class="viewcode-block" id="ModeShapePlot.take_chan_dof"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.take_chan_dof">[docs]</a>    <span class="k">def</span> <span class="nf">take_chan_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">dof</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove the arrow and text objects associated with the channel -</span>
<span class="sd">        DOF assignement received by a signal</span>
<span class="sd">        remove the channel - DOF assignement from the internal table, too</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dof</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>

        <span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">z_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="n">x_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="n">z_e</span> <span class="o">=</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_s</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_s</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_s</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">x_s_</span><span class="p">,</span> <span class="n">x_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">y_s_</span><span class="p">,</span> <span class="n">y_e_</span><span class="p">),</span> <span class="p">(</span><span class="n">z_s_</span><span class="p">,</span> <span class="n">z_e_</span><span class="p">)</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_verts3d</span>
            <span class="k">if</span> <span class="n">nearly_equal</span><span class="p">(</span><span class="n">x_s_</span><span class="p">,</span> <span class="n">x_s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nearly_equal</span><span class="p">(</span><span class="n">x_e_</span><span class="p">,</span> <span class="n">x_e</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="n">nearly_equal</span><span class="p">(</span><span class="n">y_s_</span><span class="p">,</span> <span class="n">y_s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nearly_equal</span><span class="p">(</span><span class="n">y_e_</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="n">nearly_equal</span><span class="p">(</span><span class="n">z_s_</span><span class="p">,</span> <span class="n">z_s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nearly_equal</span><span class="p">(</span><span class="n">z_e_</span><span class="p">,</span> <span class="n">z_e</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;chandof_object not found&#39;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>

<div class="viewcode-block" id="ModeShapePlot.draw_axis"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_axis">[docs]</a>    <span class="k">def</span> <span class="nf">draw_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draw the axis arrows</span>
<span class="sd">        length is based on the current datalimits</span>
<span class="sd">        removes the current arrows if the exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span>
                <span class="n">Arrow3D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        

        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span>
                <span class="n">Arrow3D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>


        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span>
                <span class="n">Arrow3D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">],</span> 
                        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapePlot.refresh_axis"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_axis">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="n">visible</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span> <span class="o">=</span> <span class="n">visible</span>
        
        <span class="k">for</span> <span class="n">objs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.draw_nodes"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">draw_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;&#39;</span>
<span class="sd">        draw gridpoints from self.geometry_data.nodes</span>
<span class="sd">        the currently stored displacement values are used for moving the nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">node</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="o">*</span><span class="n">node</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="ModeShapePlot.refresh_nodes"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span> <span class="o">=</span> <span class="n">visible</span>
            
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">disp_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">phase_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phase_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phase_node</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phase_node</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="c1">#print(&#39;in refresh nodes&#39;, x,y,z)</span>
                <span class="c1">#if &#39;PIV&#39; in key:</span>
                <span class="c1">#    print(key, disp_node, phase_node)</span>
                    
                <span class="n">patch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
                <span class="n">patch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
                
                <span class="n">patch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
                <span class="n">patch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapePlot.draw_lines"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_lines">[docs]</a>    <span class="k">def</span> <span class="nf">draw_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draw all the beams in self.geometry_data.lines</span>
<span class="sd">        self.geometry_data.lines=[line1, line2,....]</span>
<span class="sd">            line = [node_start, node_end]</span>
<span class="sd">            node numbering refers to elements in self.nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_nd_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_lines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_nd_lines</span><span class="p">()</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_cn_line</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>
            
        
<div class="viewcode-block" id="ModeShapePlot.refresh_lines"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_lines">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span> <span class="o">=</span> <span class="n">visible</span>
            
        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_node</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span><span class="p">)</span>     
            <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">disp_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">phi_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>     
            <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>      
            
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>    </div>
        
<div class="viewcode-block" id="ModeShapePlot.refresh_nd_lines"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_nd_lines">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_nd_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span> <span class="o">=</span> <span class="n">visible</span>
            
        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_node</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> 
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>     
            <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
               
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">disp_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">phi_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">disp_node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="n">phi_node</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>     
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>    
            
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapePlot.draw_master_slaves"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_master_slaves">[docs]</a>    <span class="k">def</span> <span class="nf">draw_master_slaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draw arrows for all master-slave definitions stored in the</span>
<span class="sd">        internal master-slave definition table</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">master_slaves</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_master_slave</span><span class="p">(</span><span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ModeShapePlot.refresh_master_slaves"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_master_slaves">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_master_slaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        will not be shown in displaced mode (modeshape)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_master_slaves</span> <span class="o">=</span> <span class="n">visible</span>
            
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_master_slaves</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span> </div>
            
<div class="viewcode-block" id="ModeShapePlot.draw_chan_dofs"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_chan_dofs">[docs]</a>    <span class="k">def</span> <span class="nf">draw_chan_dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        draw arrows and numbers for all channel-DOF assignments stored </span>
<span class="sd">        in the internal channel - DOF assignment table</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chan_dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span><span class="p">):</span>
            
            <span class="n">chan</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">chan_name</span> <span class="o">=</span> <span class="n">chan_dof</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">chan_dof</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_chan_dof</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">chan_name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ModeShapePlot.refresh_chan_dofs"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.refresh_chan_dofs">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_chan_dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        will not be shown in displaced mode (modeshape)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">visible</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_chan_dofs</span> <span class="o">=</span> <span class="n">visible</span>
            
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_chan_dofs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapePlot.rescale_mode_shape"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.rescale_mode_shape">[docs]</a>    <span class="k">def</span> <span class="nf">rescale_mode_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modeshape</span><span class="p">):</span>
        <span class="c1">#scaling of mode shape</span>
        <span class="n">modeshape</span> <span class="o">=</span> <span class="n">modeshape</span> <span class="o">/</span> <span class="n">modeshape</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">modeshape</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">modeshape</span></div>
    
<div class="viewcode-block" id="ModeShapePlot.draw_msh"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.draw_msh">[docs]</a>    <span class="k">def</span> <span class="nf">draw_msh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        assigns displacement values to the</span>
<span class="sd">        nodes based on the channel - DOF assignments and the master - </span>
<span class="sd">        slave definitions</span>
<span class="sd">        draws the displaced nodes and beams</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">def</span> <span class="nf">to_phase_mag</span><span class="p">(</span><span class="n">disp</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">:</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> 
                <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">phase</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> 
                    <span class="n">phase</span> <span class="o">+=</span> <span class="mi">180</span>
                    <span class="n">mag</span> <span class="o">=</span> <span class="o">-</span><span class="n">mag</span>
                <span class="k">if</span> <span class="n">phase</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">and</span> <span class="n">phase</span> <span class="o">&lt;</span> <span class="mi">270</span><span class="p">:</span>
                    <span class="n">mag</span> <span class="o">=</span> <span class="o">-</span> <span class="n">mag</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">phase</span><span class="p">,</span> <span class="n">mag</span>
        
        <span class="n">mode_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shapes</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1">#print(mode_shape)</span>
        <span class="n">mode_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescale_mode_shape</span><span class="p">(</span><span class="n">mode_shape</span><span class="p">)</span>
        <span class="n">ampli</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">}</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">}</span>
        
        <span class="n">chan_found</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mode_shape</span><span class="p">))]</span>
        
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">this_chan_dofs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">chan_dof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span><span class="p">:</span>
                <span class="n">chan</span><span class="p">,</span> <span class="n">node_</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">chan_name</span> <span class="o">=</span> <span class="n">chan_dof</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">chan_dof</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">node_</span> <span class="o">==</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">disp</span> <span class="o">=</span> <span class="n">mode_shape</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span>
                        
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_xyz</span><span class="p">(</span><span class="n">az</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">elev</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1"># radius 1 is needed for the coordinate transformation to work</span>
                    
                    <span class="n">this_chan_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chan</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">disp</span><span class="p">])</span>
                    
                    <span class="n">chan_found</span><span class="p">[</span><span class="n">chan</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_chan_dofs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># no sensors in this node</span>
            
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_chan_dofs</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># only one sensor in this node</span>
                <span class="n">chan</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">disp</span> <span class="o">=</span> <span class="n">this_chan_dofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">phase</span><span class="p">,</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">to_phase_mag</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                        
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                
            <span class="k">else</span><span class="p">:</span> <span class="c1"># two or more sensors in this node</span>
                
                <span class="c1"># check if sensors are in direction of the coordinate </span>
                <span class="c1"># system or if they need to be transformed</span>
                <span class="n">sum_x</span><span class="o">=</span> <span class="mi">0</span>
                <span class="n">sum_y</span><span class="o">=</span> <span class="mi">0</span>
                <span class="n">sum_z</span><span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">chan</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">disp</span> <span class="ow">in</span> <span class="n">this_chan_dofs</span><span class="p">:</span>
                    <span class="c1">#print(chan,x,y,z)</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">sum_x</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">y</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">sum_y</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">z</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">sum_z</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1">#print(sum_x, sum_y, sum_z)</span>
                <span class="k">if</span> <span class="n">sum_x</span><span class="o">&lt;=</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">sum_y</span><span class="o">&lt;=</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">sum_z</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># sensors are in coordinate direction</span>
                    
                    <span class="k">for</span> <span class="n">chan</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">disp</span> <span class="ow">in</span> <span class="n">this_chan_dofs</span><span class="p">:</span>
                        
                        <span class="n">phase</span><span class="p">,</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">to_phase_mag</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">x</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                        <span class="k">elif</span> <span class="n">y</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                        <span class="k">elif</span> <span class="n">z</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">num_sensors</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_chan_dofs</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
                    <span class="c1"># at least three sensors are needed for the coordinate transformation</span>
                    <span class="c1"># if only two sensors are present, they will be complemented by </span>
                    <span class="c1"># a zero displacement assumption in perpendicular direction </span>
                    <span class="n">normal_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_sensors</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                    <span class="n">disp_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_sensors</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">chan</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">disp</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">this_chan_dofs</span><span class="p">):</span>
                        <span class="n">normal_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
                        <span class="n">disp_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span><span class="n">disp</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># only two sensors were present</span>
                        <span class="c1">#print(&#39;Not enough sensors for a full 3D transformation at node {}, &#39;</span>
                        <span class="c1">#      &#39;will complement vectors with a zero displacement assumption in orthogonal direction.&#39;.format(node))</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">normal_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span> <span class="c1"># vector c is perpendicular to the first two vectors</span>
                        <span class="n">c</span><span class="o">/=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1"># if angle between first two vectors is different from 90° vector c has to be normalized</span>
                        <span class="c1">#print(node, c)</span>
                        <span class="n">normal_matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">=</span><span class="n">c</span>
                    
                    
                    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                    ⎡ n_1,x  n_1,y  n_1,z ⎤ ⎡ q_res_x ⎤   ⎡ d_1 ⎤</span>
<span class="sd">                    ⎢ n_2,x  n_2,y  n_2,z ⎥ ⎢ q_res_y ⎥ = ⎢ d_2 ⎥</span>
<span class="sd">                    ⎣ n_3,x  n_3,y  n_3,z ⎦ ⎣ q_res_z ⎦   ⎣ d_3 ⎦</span>
<span class="sd">                    &#39;&#39;&#39;</span>
                    <span class="c1"># solve the well- or over-determined system of equations</span>
                    <span class="n">q_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">normal_matrix</span><span class="p">,</span> <span class="n">disp_vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">disp</span> <span class="o">=</span> <span class="n">q_res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="c1">#print(disp)</span>
                        <span class="n">phase</span><span class="p">,</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">to_phase_mag</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
                            
                        <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mag</span> <span class="o">*</span> <span class="n">ampli</span>

<span class="c1">#         for chan, disp in enumerate(mode_shape):</span>
<span class="c1">#             if isinstance(disp, np.complex):</span>
<span class="c1">#                 if self.real:</span>
<span class="c1">#                     phase = np.angle(disp, True) </span>
<span class="c1">#                     disp = np.abs(disp)</span>
<span class="c1">#                     if phase &lt; 0 : </span>
<span class="c1">#                         phase += 180</span>
<span class="c1">#                         disp = -disp                    </span>
<span class="c1">#                     if phase &gt; 90 and phase &lt; 270:</span>
<span class="c1">#                         disp = - disp</span>
<span class="c1">#                     phase = 0</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     phase = np.angle(disp)</span>
<span class="c1">#                     disp = np.abs(disp)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 phase = 0   </span>
<span class="c1">#             found = False </span>
<span class="c1">#             for chan_dof in self.chan_dofs:</span>
<span class="c1">#                 chan_, node, az, elev, chan_name = chan_dof[0:4]+chan_dof[-1:]</span>
<span class="c1">#                 if node is None:</span>
<span class="c1">#                     continue</span>
<span class="c1">#                 if not node in self.geometry_data.nodes.keys():</span>
<span class="c1">#                     continue</span>
<span class="c1">#                 if chan_ == chan:</span>
<span class="c1">#                     x,y,z = self.calc_xyz(az*np.pi/180, elev*np.pi/180)</span>
<span class="c1">#                     if &#39;PIV&#39; in chan_name:</span>
<span class="c1">#                         print(chan_name,x,y,z)</span>
<span class="c1">#                         print(node, self.disp_nodes[node],self.phi_nodes[node])</span>
<span class="c1">#                     #print(chan_, chan, node, x,y,disp,np.degrees(phase))</span>
<span class="c1">#                     #print(x,y,z)</span>
<span class="c1">#                     </span>
<span class="c1">#                     # TODO: Account for skewed measurement angles</span>
<span class="c1">#                     # assumes vectors have components in one direction (x,y,z) only</span>
<span class="c1">#                     </span>
<span class="c1">#                     </span>
<span class="c1">#                     </span>
<span class="c1">#                     </span>
<span class="c1">#                     </span>
<span class="c1">#                     if not np.allclose(x,0):</span>
<span class="c1">#                         #print(x, phase)</span>
<span class="c1">#                         if self.disp_nodes[node][0] != 0:</span>
<span class="c1">#                             print(&#39;A modal coordinate has already been assigned to this DOF x of node {}. Overwriting!&#39;.format(node))</span>
<span class="c1">#                             </span>
<span class="c1">#                         self.phi_nodes[node][0] = phase</span>
<span class="c1">#                         self.disp_nodes[node][0] = x * disp * ampli #/ norm</span>
<span class="c1">#                     if not np.allclose(y,0):</span>
<span class="c1">#                         #print(y,phase)</span>
<span class="c1">#                         if self.disp_nodes[node][1] != 0:</span>
<span class="c1">#                             print(&#39;A modal coordinate has already been assigned to this DOF y of node {}. Overwriting!&#39;.format(node))</span>
<span class="c1">#                         self.phi_nodes[node][1] = phase</span>
<span class="c1">#                         self.disp_nodes[node][1] = y * disp * ampli #/ norm</span>
<span class="c1">#                     if not np.allclose(z,0):</span>
<span class="c1">#                         #print(z,phase)</span>
<span class="c1">#                         if self.disp_nodes[node][2] != 0:</span>
<span class="c1">#                             print(&#39;A modal coordinate has already been assigned to this DOF z of node {}. Overwriting!&#39;.format(node))</span>
<span class="c1">#                         self.phi_nodes[node][2] = phase</span>
<span class="c1">#                         self.disp_nodes[node][2] = z * disp * ampli #/ norm</span>
<span class="c1">#                     </span>
<span class="c1">#                     found=True</span>
            
        <span class="k">for</span> <span class="n">chan</span><span class="p">,</span> <span class="n">found</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chan_found</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not find channel - DOF assignment for &#39;</span>
                      <span class="s1">&#39;channel </span><span class="si">{}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">))</span>
        <span class="c1">#print(self.disp_nodes)</span>
        <span class="c1"># TODO: change master_slave assignment to skewed coordinate </span>
        <span class="c1"># TODO: change master_slaves to az, elev</span>
        
        <span class="k">for</span> <span class="n">i_m</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span><span class="p">,</span> <span class="n">i_sl</span><span class="p">,</span> <span class="n">x_sl</span><span class="p">,</span> <span class="n">y_sl</span><span class="p">,</span> <span class="n">z_sl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">master_slaves</span><span class="p">:</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="n">x_m</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">+</span><span class="n">y_m</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">+</span><span class="n">z_m</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Master DOF includes more than one cartesian direction. Phase angles will be distorted.&#39;</span><span class="p">)</span>
            
            <span class="n">master_disp</span> <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_m</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_m</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_m</span>
                            
            <span class="n">master_phase</span> <span class="o">=</span>   <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_m</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_m</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_m</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_m</span>
                            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="c1">#print(x, phase)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A modal coordinate has already been assigned to this DOF x of node </span><span class="si">{}</span><span class="s1">. Overwriting!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">master_disp</span> <span class="o">*</span> <span class="n">x_sl</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="c1">#print(y,phase)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A modal coordinate has already been assigned to this DOF y of node </span><span class="si">{}</span><span class="s1">. Overwriting!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">master_disp</span> <span class="o">*</span> <span class="n">y_sl</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="c1">#print(z,phase)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A modal coordinate has already been assigned to this DOF z of node </span><span class="si">{}</span><span class="s1">. Overwriting!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">i_sl</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">master_disp</span> <span class="o">*</span> <span class="n">z_sl</span>

<span class="c1">#             if self.draw_trace:</span>
<span class="c1">#                 if self.trace_objects:</span>
<span class="c1">#                     for i in range(len(self.trace_objects)-1,-1,-1):</span>
<span class="c1">#                         try:</span>
<span class="c1">#                             self.trace_objects[i].remove()</span>
<span class="c1">#                         except Exception as e:</span>
<span class="c1">#                             pass</span>
<span class="c1">#                             #print(&quot;Error&quot;,e)</span>
<span class="c1">#                             </span>
<span class="c1">#                         del self.trace_objects[i]</span>
<span class="c1">#                         </span>
<span class="c1">#                 moving_nodes = set()</span>
<span class="c1">#                 for chan_dof in self.chan_dofs:#</span>
<span class="c1">#                     chan_, node, az, elev, chan_name  = chan_dof[0:4]+ [chan_dof[-1]]</span>
<span class="c1">#                     if node is None:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     if not node in self.geometry_data.nodes.keys():</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     moving_nodes.add(node)</span>
<span class="c1">#                 </span>
<span class="c1">#                 clist = itertools.cycle(list(matplotlib.cm.jet(np.linspace(0, 1, len(moving_nodes)))))#@UndefinedVariable</span>
<span class="c1">#                 for node in moving_nodes:</span>
<span class="c1">#                     self.trace_objects.append(self.subplot.plot(xs=self.geometry_data.nodes[node][0] + self.disp_nodes[node][0]</span>
<span class="c1">#                          * np.cos(np.linspace(0,359,360) / 360 * 2 * np.pi  + self.phi_nodes[node][0]),</span>
<span class="c1">#                          ys=self.geometry_data.nodes[node][1] + self.disp_nodes[node][1]</span>
<span class="c1">#                          * np.cos(np.linspace(0,359,360) / 360 * 2 * np.pi  + self.phi_nodes[node][1]),</span>
<span class="c1">#                          zs=self.geometry_data.nodes[node][2] + self.disp_nodes[node][2]</span>
<span class="c1">#                          * np.cos(np.linspace(0,359,360) / 360 * 2 * np.pi  + self.phi_nodes[node][2]), </span>
<span class="c1">#                          #marker = &#39;,&#39;, s=1, edgecolor=&#39;none&#39;, </span>
<span class="c1">#                          color = next(clist)))</span>
        <span class="c1">#print(self.disp_nodes, self.phi_nodes)       </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_nodes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_lines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_chan_dofs</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_master_slaves</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.stop_ani"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.stop_ani">[docs]</a>    <span class="k">def</span> <span class="nf">stop_ani</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convenience method to stop the animation and restore the still plot</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq_num</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">frame_seq</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_handles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_nodes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_nodes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_lines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_nd_lines</span><span class="p">()</span></div>
            <span class="c1">#self.draw_msh()</span>
            
            
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.animate"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.animate">[docs]</a>    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create necessary objects to animate the currently displayed</span>
<span class="sd">        deformed structure</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">save_ani</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        !!!</span>
<span class="sd">        </span>
<span class="sd">        The NUMBERING of the FILES follows the order in which the modes were selected in the stabilization diagramm</span>
<span class="sd">        </span>
<span class="sd">        !!!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_ani</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="s1">&#39;/vegas/users/staff/womo1998/Projects/2019_Schwabach/tex/figures/ani_high/&#39;</span><span class="c1">#os.getcwd()</span>
            <span class="c1">#for i in range(len(self.select_modes)):</span>
            <span class="c1">#    os.makedirs(os.path.join(self.cwd,str(i)), exist_ok=True)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_trace</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">def</span> <span class="nf">init_lines</span><span class="p">():</span>
            <span class="c1">#print(&#39;init&#39;)</span>
            <span class="c1">#self.clear_plot()</span>
            <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="c1">#return self.lines_objects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_axis</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span><span class="n">maxx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span><span class="p">)</span>
            
<span class="c1">#             this_dirs={}</span>
<span class="c1">#             </span>
<span class="c1">#             for node in [&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;]:</span>
<span class="c1">#                 this_chans, this_az = [],[]</span>
<span class="c1">#                 for chan, node_, az,elev,header in self.chan_dofs:</span>
<span class="c1">#                     if node == node_:</span>
<span class="c1">#                         this_chans.append(chan)</span>
<span class="c1">#                         this_az.append(az)</span>
<span class="c1">#                 if len(this_chans) != 2:</span>
<span class="c1">#                     continue    </span>
<span class="c1">#                 </span>
<span class="c1">#                 this_dirs[node]={}    </span>
<span class="c1">#                 </span>
<span class="c1">#                 x,y=[],[]</span>
<span class="c1">#                 for t in np.linspace(-np.pi,np.pi,359):</span>
<span class="c1">#                     x.append(0)</span>
<span class="c1">#                     y.append(0)</span>
<span class="c1">#                     for j,az in enumerate(this_az):</span>
<span class="c1">#                         x_,y_= self.calc_xy(np.radians(az))</span>
<span class="c1">#                         x[-1]+= np.abs(msh[j])*x_* np.cos(t  + np.angle(msh[j]))</span>
<span class="c1">#                         y[-1]+= np.abs(msh[j])*y_* np.cos(t  + np.angle(msh[j]))</span>
<span class="c1">#                 #plot.figure(figsize=(8,8))</span>
<span class="c1">#                 if i == 1 and k==0:</span>
<span class="c1">#                     ind = [&#39;1&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;3&#39;,&#39;2&#39;].index(node)</span>
<span class="c1">#                     import matplotlib.cm</span>
<span class="c1">#                     color=list(matplotlib.cm.hsv(np.linspace(0, 1, 7)))[ind]</span>
<span class="c1">#                     plot.plot(x,y, label=[&#39;108&#39;,&#39;126&#39;,&#39;145&#39;,&#39;160&#39;,&#39;188&#39;,&#39;TMD&#39;][ind], color=color)</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_trace</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
                            
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        
                <span class="n">moving_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">chan_dof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span><span class="p">:</span><span class="c1">#</span>
                    <span class="n">chan_</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="o">=</span> <span class="n">chan_dof</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">continue</span>
                    <span class="n">moving_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="c1">#clist = itertools.cycle(list(matplotlib.cm.jet(np.linspace(0, 1, len(moving_nodes)))))#@UndefinedVariable</span>
                <span class="n">clist</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="s1">&#39;darkgray&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">moving_nodes</span><span class="p">))])</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">moving_nodes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trace_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                         <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">359</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                         <span class="n">ys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                         <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">359</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                         <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">359</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> 
                         <span class="c1">#marker = &#39;,&#39;, s=1, edgecolor=&#39;none&#39;, </span>
                         <span class="n">color</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">clist</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))))</span>
                
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">+</span> \
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="c1">#return self.lines_objects#, self.nd_lines_objects</span>
        
        <span class="k">def</span> <span class="nf">update_lines</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            subfunction to calculate displacements based on magnitude and phase angle</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c1">#print(num)</span>
            
<span class="c1">#             if not self.traced: clist = itertools.cycle(matplotlib.rcParams[&#39;axes.color_cycle&#39;])</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_node</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                     <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> 
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                     <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> 
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                     <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> 
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>

                <span class="c1"># NOTE: there is no .set_data() for 3 dim data...</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">beamcolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamcolor</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">beamstyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">beamstyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beamstyle</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">beamcolor</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">beamstyle</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">objs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_axis</span><span class="p">)</span>
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_ani</span><span class="p">:</span>        
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/ani_</span><span class="si">{}</span><span class="s1">.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">),</span> <span class="n">num</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/ani_</span><span class="si">{}</span><span class="s1">.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_modes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_index</span><span class="p">),</span> <span class="n">num</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">+</span> \
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        
        
        <span class="c1">#self.cla()</span>
        <span class="c1">#self.patches_objects = {}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="o">=</span> <span class="kc">True</span>        
        
        <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_move</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_press</span><span class="p">)</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_handles</span><span class="o">=</span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span> <span class="o">=</span> <span class="kc">None</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span>
                                      <span class="n">func</span><span class="o">=</span><span class="n">update_lines</span><span class="p">,</span>
                                      <span class="n">init_func</span><span class="o">=</span><span class="n">init_lines</span><span class="p">,</span>
                                      <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                      <span class="n">save_count</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                      <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#for i in range(self.seq_num+1): next(self.line_ani.frame_seq)</span>
        
        <span class="c1">#print(self.fig.get_size_inches())</span>
        <span class="c1"># Set up formatting for the movie files</span>
        <span class="c1">#Writer = matplotlib.animation.writers[&#39;ffmpeg&#39;]</span>
        <span class="c1">#writer = Writer(fps=25, metadata=dict(artist=&#39;Me&#39;), bitrate=1800)</span>
        <span class="c1">#self.line_ani.save(&#39;lines.mp4&#39;, writer=writer)</span>
        <span class="c1">#print(self.fig.get_size_inches())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
        <span class="c1">#self.line_ani._start()</span>
        <span class="c1">#print(self.animated, self.line_ani)</span>
        
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapePlot.filter_and_animate_data"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapePlot.filter_and_animate_data">[docs]</a>    <span class="k">def</span> <span class="nf">filter_and_animate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create necessary objects to animate the currently displayed</span>
<span class="sd">        deformed structure</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">init_lines</span><span class="p">():</span>
            <span class="c1">#print(&#39;init&#39;)</span>
            <span class="c1">#self.clear_plot()</span>
            <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="c1">#return self.lines_objects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_lines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span><span class="n">maxx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">+</span> \
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="c1">#return self.lines_objects#, self.nd_lines_objects</span>
        <span class="k">def</span> <span class="nf">update_lines</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            subfunction to calculate displacements based on magnitude and phase angle</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">num</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">sampling_rate</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">disp_nodes</span><span class="o">=</span><span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">}</span> 
            <span class="k">for</span> <span class="n">chan_dof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chan_dofs</span><span class="p">:</span>
                <span class="n">chan_</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="o">=</span> <span class="n">chan_dof</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">continue</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_xyz</span><span class="p">(</span><span class="n">az</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">elev</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
                <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement_filt</span><span class="p">[</span><span class="n">num</span><span class="p">,</span><span class="n">chan_</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span>
                <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement_filt</span><span class="p">[</span><span class="n">num</span><span class="p">,</span><span class="n">chan_</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span>
                <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement_filt</span><span class="p">[</span><span class="n">num</span><span class="p">,</span><span class="n">chan_</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span>
                
            <span class="c1">#print(num)</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_node</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                     <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">line_node</span><span class="p">]</span>
                <span class="c1"># NOTE: there is no .set_data() for 3 dim data...</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_lines</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_data</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">disp_node</span> <span class="o">=</span> <span class="n">disp_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_node</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_node</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">node</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp_node</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_nd_lines</span><span class="p">)</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                    
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">+</span> \
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>        

        <span class="c1">#self.cla()</span>
        <span class="c1">#self.patches_objects = {}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrows_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_obj</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_animated</span> <span class="o">=</span> <span class="kc">True</span>
        
        
        <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_move</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_press</span><span class="p">)</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_handles</span><span class="o">=</span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#self.prep_data.filter_data(lowpass, highpass)</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span>
                                      <span class="n">func</span><span class="o">=</span><span class="n">update_lines</span><span class="p">,</span>
                                      <span class="n">frames</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement_filt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">init_func</span><span class="o">=</span><span class="n">init_lines</span><span class="p">,</span>
                                      <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span>
                                      <span class="n">save_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
        <span class="c1">#self.line_ani._start()</span>
        <span class="c1">#print(self.animated, self.line_ani)        </span>
    <span class="k">def</span> <span class="nf">_button_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>

    <span class="k">def</span> <span class="nf">_button_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">_on_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_pressed</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_objects</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd_lines_objects</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn_lines_objects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.canvas.draw()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">_setup_blit</span><span class="p">()</span></div>
        <span class="c1">#self.line_ani._start()   </span>
        
<div class="viewcode-block" id="ModeShapeGUI"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI">[docs]</a><span class="k">class</span> <span class="nc">ModeShapeGUI</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is used for displaying modal values and modeshapes obtained</span>
<span class="sd">    by the SSICovRef class by Mihai-Andrei Udrea 2013 </span>
<span class="sd">    (Bauhaus-Universität Weimar, Institut für Strukturmechanik). An</span>
<span class="sd">    interactive GUI based on PyQt5 is used to create such plots.</span>

<span class="sd">    Abilities include:</span>

<span class="sd">    Drawing:</span>
<span class="sd">    - creation of 3d plots using matplotlib&#39;s mplot3 from the </span>
<span class="sd">        matplotlib toolkit</span>
<span class="sd">    - adjusting axis limits for each of the three axis</span>
<span class="sd">        i.e. zoom view, shift view (along single and multiple axis&#39;)</span>
<span class="sd">    - change the viewport e.g. x, y, z and isometric view</span>
<span class="sd">    - rotating and zooming through mouse interaction is currently </span>
<span class="sd">        supported by matplotlib, whereas panning is not</span>
<span class="sd">    - animate the currently displayed deformed structure</span>
<span class="sd">    - save the still frame</span>


<span class="sd">    Geometry definition:</span>
<span class="sd">    - draw single and multiple nodes (deformed and undeformed)</span>
<span class="sd">    - draw single and multiple lines (deformed and undeformed)</span>
<span class="sd">    - draw single and multiple master-slave assignments onto the nodes </span>
<span class="sd">        (undeformed only)</span>
<span class="sd">    - draw single and multiple channel-degree of freedom assignments </span>
<span class="sd">        onto the nodes (undeformed only</span>
<span class="sd">    - initiate creation/editing/loading/saving of such geometric information</span>

<span class="sd">    SSI Solutions:</span>
<span class="sd">    - load a SSI_solutions file</span>
<span class="sd">    - extract and display the following from the SSI_solutions file (*.slv):</span>
<span class="sd">        - available orders</span>
<span class="sd">        - available modes for selected order</span>
<span class="sd">        - modal values for selected mode and order</span>
<span class="sd">            frequency, damping, eigenvalue</span>
<span class="sd">        - mode shapes for selected mode and order</span>
<span class="sd">    - currently modeshapes are normalized to unit modal displacement by default</span>

<span class="sd">    currently __not__ supported:</span>
<span class="sd">    - 3D surface plots, as they are not properly supported by the </span>
<span class="sd">        underlying matplotlib api</span>
<span class="sd">    - combination of several modeshapes or sensor setups </span>
<span class="sd">        (this could be done easily in an external script)</span>
<span class="sd">    - saving of the animation as a movie file</span>
<span class="sd">    - drawing multiple modeshapes into one plot</span>
<span class="sd">    - plot modeshape in a single call from a script i.e. use static methods</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># define this class&#39;s signals and the types of data they emit</span>
    <span class="n">grid_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">beams_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">slaves_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">chan_dofs_requested</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">mode_shape_plot</span><span class="p">,</span>      
                 <span class="n">reduced_gui</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="p">,</span> <span class="n">ModeShapePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span> <span class="o">=</span> <span class="n">mode_shape_plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Plot Modeshapes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_frame</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="p">,</span> <span class="n">reduced_gui</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
<div class="viewcode-block" id="ModeShapeGUI.create_main_frame"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.create_main_frame">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode_shape_plot</span><span class="p">,</span> <span class="n">reduced_gui</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set up all the widgets and other elements to draw the GUI</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">main_frame</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        
        <span class="c1"># Create the mpl Figure and FigCanvas objects.</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">fig</span>
        <span class="n">FigureCanvasQTAgg</span><span class="o">.</span><span class="n">resizeEvent</span> <span class="o">=</span> <span class="n">resizeEvent_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">switch_backends</span><span class="p">(</span><span class="n">FigureCanvasQTAgg</span><span class="p">)</span>
        <span class="c1">#self.canvas.resize_event = resizeEvent_</span>
        <span class="c1">#self.canvas.resize_event  = funcType(resizeEvent_, self.canvas, FigureCanvasQTAgg)</span>
        <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_lims</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mouse_init</span><span class="p">()</span>

        <span class="c1">#controls for changing what to draw</span>
        <span class="n">view_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Axis Arrows&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_axis</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_axis</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Nodes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_nodes</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_nodes</span><span class="p">)</span>
        
        <span class="n">line_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Lines&#39;</span><span class="p">)</span>
        <span class="n">line_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">conn_lines_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Connecting Lines&#39;</span><span class="p">)</span>
        <span class="n">conn_lines_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">conn_lines_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_nd_lines</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="n">conn_lines_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_nd_lines</span><span class="p">)</span>
        
        <span class="n">ms_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Master-Slaves Assignm.&#39;</span><span class="p">)</span>
        <span class="n">ms_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">chandof_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Show Channel-DOF Assignm.&#39;</span><span class="p">)</span>
        <span class="n">chandof_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
            
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span> <span class="o">=</span> <span class="n">QButtonGroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">line_checkbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">ms_checkbox</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">chandof_checkbox</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">buttonClicked</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_draw</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_lines</span><span class="p">:</span>
            <span class="n">line_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_master_slaves</span><span class="p">:</span>
            <span class="n">ms_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">show_chan_dofs</span><span class="p">:</span>
            <span class="n">chandof_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="p">)</span>
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="p">)</span>
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line_checkbox</span><span class="p">)</span>
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">ms_checkbox</span><span class="p">)</span>
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">chandof_checkbox</span><span class="p">)</span>
        <span class="n">view_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">conn_lines_checkbox</span><span class="p">)</span>

        <span class="c1"># controls for changing the axis&#39; limits and viewport i.e. zoom and shift</span>
        <span class="n">axis_limits_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        
        

        
        
            
        <span class="c1"># Buttons for creating/editing geometry and loading solutions</span>
        <span class="c1">#grid_button = QPushButton(&#39;Edit Grid&#39;)</span>
        <span class="c1">#grid_button.released.connect(self.stop_ani)</span>
        <span class="c1">#grid_button.released.connect(self.geometry_creator.load_nodes)</span>

        <span class="c1">#beam_button = QPushButton(&#39;Edit Beams&#39;)</span>
        <span class="c1">#beam_button.released.connect(self.stop_ani)</span>
        <span class="c1">#beam_button.released.connect(self.geometry_creator.load_lines)</span>

        <span class="c1">#ms_button = QPushButton(&#39;Edit Master Slaves&#39;)</span>
        <span class="c1">#ms_button.released.connect(self.stop_ani)</span>
        <span class="c1">#ms_button.released.connect(self.geometry_creator.load_master_slave)</span>

        <span class="c1">#cd_button = QPushButton(&#39;Edit Channel-DOFS-Assignment&#39;)</span>
        <span class="c1">#cd_button.released.connect(self.stop_ani)</span>
        <span class="c1">#cd_button.released.connect(self.geometry_creator.load_chan_dof)</span>

        <span class="c1">#ssi_button = QPushButton(&#39;Load Modal Data&#39;)</span>
        <span class="c1">#ssi_button.released.connect(self.stop_ani)</span>
        <span class="c1">#ssi_button.released.connect(self.reload_ssi_solutions)</span>
        
        <span class="c1"># GUI controls for selecting modes and changing various </span>
        <span class="c1"># values for drawing the modeshapes</span>
        <span class="c1">#self.order_combo = QComboBox()</span>
        <span class="c1">#self.order_combo.currentIndexChanged[str].connect(self.change_order)</span>
        <span class="c1">#textbox for showing information about the currently displayed mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_box</span> <span class="o">=</span> <span class="n">QTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_box</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">get_frequencies</span><span class="p">())]</span>
        <span class="c1">#print(frequencies)</span>
        <span class="k">if</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> 
        
        
        

        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_box</span> <span class="o">=</span> <span class="n">DelayedDoubleSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_box</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_box</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude_box</span><span class="o">.</span><span class="n">valueChangedDelayed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">change_amplitude</span><span class="p">)</span>

        <span class="n">real_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Magn.&#39;</span><span class="p">)</span>
        <span class="n">real_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        

        <span class="n">imag_checkbox</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Magn.+Phase&#39;</span><span class="p">)</span>
        <span class="n">imag_checkbox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        

        <span class="n">real_imag_group</span> <span class="o">=</span> <span class="n">QButtonGroup</span><span class="p">()</span>
        <span class="n">real_imag_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">real_checkbox</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">real_imag_group</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">imag_checkbox</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>        
        <span class="n">real_imag_group</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#print(real_imag_group.exclusive(), real_imag_group.checkedId())</span>
        <span class="n">imag_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span> <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">real</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        
        <span class="c1">#print(real_imag_group.exclusive(), real_imag_group.checkedId())</span>
        <span class="n">real_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">real</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        
        <span class="c1">#print(real_imag_group.exclusive(), real_imag_group.checkedId())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">test_</span><span class="o">=</span><span class="n">real_imag_group</span>
        <span class="n">real_checkbox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">change_part</span><span class="p">)</span>
        <span class="c1">#real_checkbox.stateChanged[int].connect(self.test)</span>
        <span class="c1">#plot_button = QPushButton(&#39;Draw&#39;)</span>
        <span class="c1">#plot_button.released.connect(self.draw_msh)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Play&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">prep_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_lowpass_box</span> <span class="o">=</span> <span class="n">DelayedDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_lowpass_box</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_lowpass_box</span><span class="o">.</span><span class="n">valueChangedDelayed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_filter</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_highpass_box</span> <span class="o">=</span> <span class="n">DelayedDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_highpass_box</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_highpass_box</span><span class="o">.</span><span class="n">valueChangedDelayed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_filter</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_speed_box</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_speed_box</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_speed_box</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_animation_speed</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_position_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_position_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_position_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_ani_time</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_position_data</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Play&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_and_animate_data</span><span class="p">)</span>
        

        
        <span class="c1">#put everything in layouts</span>
        <span class="n">controls_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
<span class="c1">#         controls_layout.addWidget(grid_button, 0, 0)</span>
<span class="c1">#         controls_layout.addWidget(beam_button, 1, 0)</span>
<span class="c1">#         controls_layout.addWidget(ms_button, 2, 0)</span>
<span class="c1">#         controls_layout.addWidget(cd_button, 3, 0)</span>
<span class="c1">#         controls_layout.addWidget(ssi_button, 4, 0)</span>
        
        

<span class="c1">#         sep = QFrame()</span>
<span class="c1">#         sep.setFrameShape(QFrame.VLine)</span>
<span class="c1"># </span>
<span class="c1">#         controls_layout.addWidget(sep, 0, 1, 5, 1)</span>
        
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Change Viewport:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">=</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">view</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;ISO&#39;</span><span class="p">]):</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_viewport</span><span class="p">)</span>
            <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">lims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="nb">dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; Limits:&#39;</span><span class="p">)</span>
            <span class="n">r_but</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
            <span class="n">r_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">)</span>
            <span class="n">r_but</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>
            <span class="n">r_val</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
            <span class="n">r_val</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">row</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">r_val</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
            <span class="n">r_val</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>
            <span class="n">l_val</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
            <span class="n">l_val</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">row</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">l_val</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
            <span class="n">l_val</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>
            <span class="n">l_but</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
            <span class="n">l_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
            <span class="n">l_but</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="nb">dir</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">r_but</span><span class="p">,</span><span class="n">r_val</span><span class="p">,</span><span class="n">l_val</span><span class="p">,</span><span class="n">l_but</span><span class="p">]</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">r_but</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">r_val</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">l_val</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">l_but</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#controls_layout.setColumnStretch(5,10)</span>
        
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Zoom:&#39;</span><span class="p">)</span>
        <span class="n">r_but</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">r_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> 
        <span class="n">r_but</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>
        <span class="n">l_but</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">l_but</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">l_but</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">)</span>  
        
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">r_but</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">l_but</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">reset_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Reset View&#39;</span><span class="p">)</span>
        <span class="n">reset_button</span><span class="o">.</span><span class="n">released</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_view</span><span class="p">)</span>

        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">reset_button</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">sep</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">sep</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">VLine</span><span class="p">)</span>

        <span class="n">tab_widget</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">()</span>

        <span class="n">tab_1</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">lay_1</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">tab_2</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">lay_2</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="c1">#lay_1.setContentsMargins(0,0,0,0)</span>
        <span class="n">tab_1</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#lay_2.setContentsMargins(0,0,0,0)</span>
        <span class="n">tab_2</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tab_widget</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#lay_1.setVerticalSpacing(0)</span>
        <span class="c1">#lay_2.setVerticalSpacing(0)</span>
        
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude_box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Complex Modeshape:&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">real_checkbox</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">imag_checkbox</span><span class="p">)</span>
        <span class="n">lay_1</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="c1">#layout.addWidget(QLabel(&#39;Show Modeshape:&#39;))</span>
        <span class="c1">#layout.addWidget(self.ani_button)        </span>
        <span class="c1">#lay_1.addLayout(layout, 3,0,0,1)</span>
        
        <span class="n">lay_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,)</span>
        <span class="n">tab_1</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">lay_1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">prep_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Lowpass [Hz]:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_lowpass_box</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Highpass [Hz]:&#39;</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_highpass_box</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Animation Speed [ms]:&#39;</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_speed_box</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#lay_2.addWidget(self.ani_data_button,3,0,)</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_position_slider</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_position_data</span><span class="p">)</span>
            <span class="n">lay_2</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tab_2</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">lay_2</span><span class="p">)</span>
        
        <span class="n">policy</span> <span class="o">=</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span>
        <span class="n">tab_1</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span><span class="n">policy</span><span class="p">)</span>
        <span class="n">tab_2</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span><span class="n">policy</span><span class="p">)</span>
        <span class="n">tab_widget</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span> <span class="n">policy</span><span class="p">)</span>

        <span class="n">tab_widget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab_1</span><span class="p">,</span> <span class="s1">&#39;Modeshape&#39;</span><span class="p">)</span>
        <span class="n">tab_widget</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab_2</span><span class="p">,</span> <span class="s1">&#39;Time Histories&#39;</span><span class="p">)</span>
        
        <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">tab_widget</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced_gui</span><span class="p">:</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
            <span class="n">sep</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">VLine</span><span class="p">)</span>
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>        
            <span class="n">controls_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        
        <span class="n">sep1</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">sep1</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>
        
        <span class="n">sep2</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">sep2</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>

        <span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

        

        <span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sep1</span><span class="p">)</span>    
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">view_layout</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">axis_limits_layout</span><span class="p">)</span>   
        <span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sep2</span><span class="p">)</span>     
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">controls_layout</span><span class="p">)</span>

        <span class="n">main_frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="n">main_frame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#self.reset_view()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">imag_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="ModeShapeGUI.create_menu"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.create_menu">[docs]</a>    <span class="k">def</span> <span class="nf">create_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create the menubar and add actions to it</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">add_actions</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">create_action</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">signal</span><span class="o">=</span><span class="s2">&quot;triggered()&quot;</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">icon</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">shortcut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">shortcut</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">checkable</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">action</span>

        <span class="n">file_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;File&quot;</span><span class="p">)</span>

        <span class="n">load_file_action</span> <span class="o">=</span> <span class="n">create_action</span><span class="p">(</span><span class="s2">&quot;&amp;Save plot&quot;</span><span class="p">,</span>
                                         <span class="n">shortcut</span><span class="o">=</span><span class="s2">&quot;Ctrl+S&quot;</span><span class="p">,</span> 
                                         <span class="n">slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_plot</span><span class="p">,</span>
                                         <span class="n">tip</span><span class="o">=</span><span class="s2">&quot;Save the plot&quot;</span><span class="p">)</span>
        <span class="n">quit_action</span> <span class="o">=</span> <span class="n">create_action</span><span class="p">(</span><span class="s2">&quot;&amp;Quit&quot;</span><span class="p">,</span> 
                                    <span class="n">slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
                                    <span class="n">shortcut</span><span class="o">=</span><span class="s2">&quot;Ctrl+Q&quot;</span><span class="p">,</span> 
                                    <span class="n">tip</span><span class="o">=</span><span class="s2">&quot;Close the application&quot;</span><span class="p">)</span>

        <span class="n">add_actions</span><span class="p">(</span><span class="n">file_menu</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">load_file_action</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quit_action</span><span class="p">))</span>

        <span class="n">help_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Help&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ModeShapeGUI.reset_view"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.reset_view">[docs]</a>    <span class="k">def</span> <span class="nf">reset_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">reset_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_draw</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span></div>
            
    <span class="c1">##@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.change_view"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.change_view">[docs]</a>    <span class="k">def</span> <span class="nf">change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        shift the view along specified axis by +-20 % (hardcoded)</span>
<span class="sd">        works in combination with the appropriate buttons as senders</span>
<span class="sd">        or by passing one of  [&#39;+X&#39;, &#39;-X&#39;, &#39;+Y&#39;, &#39;-Y&#39;, &#39;+Z&#39;, &#39;-Z&#39;]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">widgets</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">widget</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">widgets</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="n">widget</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">val1</span><span class="p">,</span> <span class="n">val0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">rang</span> <span class="o">=</span> <span class="n">val1</span><span class="o">-</span><span class="n">val0</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">val0</span> <span class="o">-=</span><span class="n">rang</span><span class="o">*</span><span class="mf">0.2</span>
                <span class="n">val1</span> <span class="o">-=</span><span class="n">rang</span><span class="o">*</span><span class="mf">0.2</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">val0</span> <span class="o">+=</span><span class="n">rang</span><span class="o">*</span><span class="mf">0.2</span>
                <span class="n">val1</span> <span class="o">+=</span><span class="n">rang</span><span class="o">*</span><span class="mf">0.2</span>
            <span class="n">widgets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val1</span><span class="p">))</span>
            <span class="n">widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val0</span><span class="p">))</span>
            <span class="k">if</span> <span class="s1">&#39;X&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">((</span><span class="n">val0</span><span class="p">,</span><span class="n">val1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">((</span><span class="n">val0</span><span class="p">,</span><span class="n">val1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">((</span><span class="n">val0</span><span class="p">,</span><span class="n">val1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val1</span><span class="p">,</span> <span class="n">val0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">rang</span> <span class="o">=</span> <span class="n">val1</span><span class="o">-</span><span class="n">val0</span>
            <span class="k">if</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                <span class="n">rang</span> <span class="o">*=</span><span class="mf">0.8</span>
            <span class="k">elif</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">rang</span><span class="o">*=</span><span class="mf">1.25</span>
                
        <span class="k">for</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">widgets</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val1_</span><span class="p">,</span> <span class="n">val0_</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">rang_</span> <span class="o">=</span> <span class="n">val1_</span><span class="o">-</span><span class="n">val0_</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">rang_</span> <span class="o">-</span> <span class="n">rang</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">val1_</span> <span class="o">-=</span> <span class="n">delta</span>
            <span class="n">val0_</span> <span class="o">+=</span> <span class="n">delta</span>
            <span class="n">widgets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val1_</span><span class="p">))</span>
            <span class="n">widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val0_</span><span class="p">))</span>    
            <span class="k">if</span> <span class="s1">&#39;X&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">((</span><span class="n">val0_</span><span class="p">,</span><span class="n">val1_</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s1">&#39;Y&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">((</span><span class="n">val0_</span><span class="p">,</span><span class="n">val1_</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">((</span><span class="n">val0_</span><span class="p">,</span><span class="n">val1_</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ModeShapeGUI.update_lims"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.update_lims">[docs]</a>    <span class="k">def</span> <span class="nf">update_lims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">lims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">subplot</span><span class="o">.</span><span class="n">get_w_lims</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="nb">dir</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]):</span>
                <span class="p">[</span><span class="n">r_but</span><span class="p">,</span><span class="n">r_val</span><span class="p">,</span><span class="n">l_val</span><span class="p">,</span><span class="n">l_but</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_widgets</span><span class="p">[</span><span class="nb">dir</span><span class="p">]</span>
                <span class="n">r_val</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">row</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">l_val</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="n">row</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span></div>
        
                

            
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.change_viewport"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.change_viewport">[docs]</a>    <span class="k">def</span> <span class="nf">change_viewport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewport</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change the viewport</span>
<span class="sd">        for non-ISO viewports the projection methods of matplotlib</span>
<span class="sd">        will be monkeypatched, because otherwise it would not be an </span>
<span class="sd">        axonometric view (functions are defined at the top of document)</span>
<span class="sd">        works in combination with the appropriate buttons as senders or</span>
<span class="sd">        by passing one of [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;ISO&#39;]</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">viewport</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">viewport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">change_viewport</span><span class="p">(</span><span class="n">viewport</span><span class="p">)</span></div>
                    
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.save_plot"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.save_plot">[docs]</a>    <span class="k">def</span> <span class="nf">save_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        save the curently displayed frame as a *.png graphics file</span>
<span class="sd">        &#39;&#39;&#39;</span>
                <span class="c1"># copied and modified from matplotlib.backends.backend_qt4.NavigationToolbar2QT</span>
        <span class="n">canvas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        
        <span class="n">filetypes</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_supported_filetypes_grouped</span><span class="p">()</span>
        <span class="n">sorted_filetypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filetypes</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">sorted_filetypes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">default_filetype</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
        
        <span class="n">startpath</span> <span class="o">=</span> <span class="n">rcParams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;savefig.directory&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">startpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">startpath</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">startpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_default_filename</span><span class="p">())</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">selectedFilter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">exts</span> <span class="ow">in</span> <span class="n">sorted_filetypes</span><span class="p">:</span>
            <span class="n">exts_list</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;*.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">])</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">exts_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_filetype</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">:</span>
                <span class="n">selectedFilter</span> <span class="o">=</span> <span class="nb">filter</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="s1">&#39;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        
        
        <span class="n">fname</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Choose a filename to save to&quot;</span><span class="p">,</span>
                                       <span class="n">directory</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">save_plot</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;Saved to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ModeShapeGUI.plot_this"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.plot_this">[docs]</a>    <span class="k">def</span> <span class="nf">plot_this</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1">#self.mode_shape_plot.stop_ani()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
        <span class="c1">#self.animate()</span>
        
    <span class="c1">#@pyqtSlot(str)</span>
<div class="viewcode-block" id="ModeShapeGUI.change_mode"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.change_mode">[docs]</a>    <span class="k">def</span> <span class="nf">change_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if user selects a new mode,</span>
<span class="sd">        extract the mode number from the passed string (contains frequency...)</span>
<span class="sd">        write modal values to the infobox</span>
<span class="sd">        and plot the mode shape</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1">#print(&#39;in change_mode: mode = &#39;, mode)</span>

        <span class="c1"># mode numbering starts at 1 python lists start at 0</span>
        <span class="n">mode_num</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="c1"># if mode is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mode_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="k">return</span>
        
        <span class="n">mode_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mode_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">-</span> <span class="mi">1</span> 
        <span class="n">frequency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mode</span><span class="p">,</span><span class="n">order</span><span class="p">,</span><span class="n">frequency</span><span class="p">,</span> <span class="n">damping</span><span class="p">,</span> <span class="n">MPC</span><span class="p">,</span> <span class="n">MP</span><span class="p">,</span> <span class="n">MPD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">change_mode</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Selected Mode</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;=======================</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;Frequency [Hz]:</span><span class="se">\t</span><span class="s1">&#39;</span>           <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>    <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;Damping [%]:</span><span class="se">\t</span><span class="s1">&#39;</span>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">damping</span><span class="p">)</span>    <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;Model order:</span><span class="se">\t</span><span class="s1">&#39;</span>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>      <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;Mode number: </span><span class="se">\t</span><span class="s1">&#39;</span>           <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>       <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;MPC [-]:</span><span class="se">\t</span><span class="s1">&#39;</span>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MPC</span><span class="p">)</span>        <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;MP  [</span><span class="se">\u00b0</span><span class="s1">]:</span><span class="se">\t</span><span class="s1">&#39;</span>           <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MP</span><span class="p">)</span>         <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>\
                      <span class="o">+</span> <span class="s1">&#39;MPD [-]:</span><span class="se">\t</span><span class="s1">&#39;</span>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MPD</span><span class="p">)</span>        <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="c1">#print(text)             </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


    <span class="c1">#@pyqtSlot(int)</span>
<div class="viewcode-block" id="ModeShapeGUI.toggle_draw"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.toggle_draw">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        helper function to receive the signal from the draw_button_group</span>
<span class="sd">        i is the number of the button that had it&#39;s state changed</span>
<span class="sd">        based on i and the checkstate the appropriate functions will be called</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">buttonClicked</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_lines</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_master_slaves</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_chan_dofs</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="n">i</span><span class="p">:</span><span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_lines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_master_slaves</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">refresh_chan_dofs</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_button_group</span><span class="o">.</span><span class="n">buttonClicked</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_draw</span><span class="p">)</span></div>


    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.stop_ani"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.stop_ani">[docs]</a>    <span class="k">def</span> <span class="nf">stop_ani</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convenience method to stop the animation and restore the still plot</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animated</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.animate"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.animate">[docs]</a>    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create necessary objects to animate the currently displayed</span>
<span class="sd">        deformed structure</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#self.axis_checkbox.setCheckState(False)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPause</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">animate</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ModeShapeGUI.prepare_filter"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.prepare_filter">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lowpass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ani_lowpass_box</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">highpass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ani_highpass_box</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="c1">#print(lowpass, highpass)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lowpass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lowpass</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">lowpass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">highpass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">highpass</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">highpass</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">lowpass</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">lowpass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">highpass</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">highpass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">lowpass</span> <span class="ow">and</span> <span class="n">highpass</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">lowpass</span> <span class="o">&gt;</span> <span class="n">highpass</span>
        <span class="c1">#print(highpass, lowpass)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">filter_data</span><span class="p">(</span><span class="n">lowpass</span><span class="p">,</span> <span class="n">highpass</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ModeShapeGUI.set_ani_time"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.set_ani_time">[docs]</a>    <span class="k">def</span> <span class="nf">set_ani_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="c1">#print(pos)</span>
        <span class="n">tot_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">prep_data</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#pos = int(pos*tot_len)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">frame_seq</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">tot_len</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="ModeShapeGUI.change_animation_speed"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.change_animation_speed">[docs]</a>    <span class="k">def</span> <span class="nf">change_animation_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1">#print(speed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">line_ani</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">_timer_set_interval</span><span class="p">()</span></div>
         
    <span class="c1">#@pyqtSlot()</span>
<div class="viewcode-block" id="ModeShapeGUI.filter_and_animate_data"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.filter_and_animate_data">[docs]</a>    <span class="k">def</span> <span class="nf">filter_and_animate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create necessary objects to animate the currently displayed</span>
<span class="sd">        deformed structure</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">data_animated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">animated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ani_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPlay</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ani_data_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MediaPause</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">filter_and_animate_data</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ani_position_data</span><span class="o">.</span><span class="n">setText</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ModeShapeGUI.closeEvent"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.ModeShapeGUI.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_shape_plot</span><span class="o">.</span><span class="n">stop_ani</span><span class="p">()</span>
        <span class="n">FigureCanvasQTAgg</span><span class="o">.</span><span class="n">resizeEvent</span> <span class="o">=</span> <span class="n">old_resize_event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">QMainWindow</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   </div></div>


<div class="viewcode-block" id="Arrow3D"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.Arrow3D">[docs]</a><span class="k">class</span> <span class="nc">Arrow3D</span><span class="p">(</span><span class="n">FancyArrowPatch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    credit goes to (don&#39;t know the original author):</span>
<span class="sd">    http://pastebin.com/dWvFxb1Q</span>
<span class="sd">    draw an arrow in 3D space</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        inherit from FancyArrowPatch</span>
<span class="sd">        and set self._verts3d class variable</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verts3d</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span>

<div class="viewcode-block" id="Arrow3D.draw"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.Arrow3D.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get the projection from the 3D point to 2D point to draw the arrow</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verts3d</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="n">proj3d</span><span class="o">.</span><span class="n">proj_transform</span><span class="p">(</span><span class="n">xs3d</span><span class="p">,</span> <span class="n">ys3d</span><span class="p">,</span> <span class="n">zs3d</span><span class="p">,</span> <span class="n">renderer</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span></div></div>


<span class="c1"># class GeometryCreator(QMainWindow):</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     GUI for creating/editing/loading/saving node, lines, </span>
<span class="c1">#     master-slave definitions and channel-DOF assignments.</span>
<span class="c1">#     several signals automatically emit any changes made with this GUI,</span>
<span class="c1">#     such that they can be processed in a class that plots these things.</span>
<span class="c1">#     </span>
<span class="c1">#     Files are assumed to be in a matlab compatible, csv readable ascii </span>
<span class="c1">#     format, with whitespace delimiters:</span>
<span class="c1">#     possible node definitions (scientific notation):</span>
<span class="c1">#       1.0000000e+000 -2.4000000e+000 -2.4000000e+000  0.0000000e+000</span>
<span class="c1">#       2.0000000e+000 -2.4000000e+000  2.4000000e+000  0.0000000e+000</span>
<span class="c1">#       ....</span>
<span class="c1">#     possible channel-DOF assignments (float/int notation):</span>
<span class="c1">#      1  0  9  0.000  0.000  1.000</span>
<span class="c1">#      2  1  1  0.000  0.000  1.000</span>
<span class="c1">#      ...</span>
<span class="c1">#     others are similar.</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     # define pyqtSignals that can be connected to</span>
<span class="c1">#     node_added = pyqtSignal(float, float, float, int)</span>
<span class="c1">#     node_taken = pyqtSignal(float, float, float, int)</span>
<span class="c1"># </span>
<span class="c1">#     line_added = pyqtSignal(tuple, int)</span>
<span class="c1">#     line_taken = pyqtSignal(tuple)</span>
<span class="c1"># </span>
<span class="c1">#     slave_added = pyqtSignal(</span>
<span class="c1">#         int, float, float, float, int, float, float, float, int)</span>
<span class="c1">#     slave_taken = pyqtSignal(</span>
<span class="c1">#         int, float, float, float, int, float, float, float)</span>
<span class="c1"># </span>
<span class="c1">#     chan_dof_added = pyqtSignal(int, int, tuple, int)</span>
<span class="c1">#     chan_dof_taken = pyqtSignal(int, int, tuple)</span>
<span class="c1"># </span>
<span class="c1">#     return_to_func = pyqtSignal()</span>
<span class="c1"># </span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         initiate the class,</span>
<span class="c1">#         inherit from QMainWindow</span>
<span class="c1">#         create class variables</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         super(GeometryCreator, self).__init__()</span>
<span class="c1"># </span>
<span class="c1">#         # not sure if it is necessary to hold a copy of these variables in this class&#39;s memory</span>
<span class="c1">#         # these variables should always be equal to the ones in PlotMSH object</span>
<span class="c1">#         </span>
<span class="c1">#         # node tables are dicts to make node numbering with gaps possible</span>
<span class="c1">#         # else we would have to store node numbers in a separate list which</span>
<span class="c1">#         # has to be kept in sync with the coordinates tables</span>
<span class="c1">#         self.xs, self.ys, self.zs = {}, {}, {}</span>
<span class="c1">#         self.lines = []</span>
<span class="c1">#         self.master_slaves = []</span>
<span class="c1">#         self.chan_dofs = []</span>
<span class="c1"># </span>
<span class="c1">#         self.last_path = os.getcwd()</span>
<span class="c1"># </span>
<span class="c1">#     def show_creation_widget(self, type_=&#39;nodes&#39;):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         draw a widget containing:</span>
<span class="c1">#         several inputboxes (QSpinBox, QDoubleSpinBox) for defining </span>
<span class="c1">#         the values for nodes, lines, master slaves and channel dof assignments</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         &#39;types =  [nodes, lines master_slaves, chan_dofs]&#39;</span>
<span class="c1"># </span>
<span class="c1">#         main_frame = QWidget()</span>
<span class="c1"># </span>
<span class="c1">#         inp_box = QGridLayout()</span>
<span class="c1">#         self.add_button = QPushButton(&#39;Add&#39;)</span>
<span class="c1"># </span>
<span class="c1">#         if type_ == &#39;nodes&#39;:</span>
<span class="c1">#             self.setWindowTitle(&#39;Edit Nodes&#39;)</span>
<span class="c1">#             </span>
<span class="c1">#             self.x_input = QDoubleSpinBox()</span>
<span class="c1">#             self.x_input.setRange(-1000, 1000)</span>
<span class="c1">#             self.y_input = QDoubleSpinBox()</span>
<span class="c1">#             self.y_input.setRange(-1000, 1000)</span>
<span class="c1">#             self.z_input = QDoubleSpinBox()</span>
<span class="c1">#             self.z_input.setRange(-1000, 1000)</span>
<span class="c1"># </span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;x&#39;), 0, 0)</span>
<span class="c1">#             inp_box.addWidget(self.x_input, 1, 0)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;y&#39;), 0, 1)</span>
<span class="c1">#             inp_box.addWidget(self.y_input, 1, 1)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;z&#39;), 0, 2)</span>
<span class="c1">#             inp_box.addWidget(self.z_input, 1, 2)</span>
<span class="c1"># </span>
<span class="c1">#             self.add_button.released.connect(self.add_node)</span>
<span class="c1"># </span>
<span class="c1">#             self.coordinates_list = QTableWidget(0, 4)</span>
<span class="c1"># </span>
<span class="c1">#             load_button = QPushButton(&#39;Load Gridfile&#39;)</span>
<span class="c1">#             load_button.released.connect(self.load_new_nodes)</span>
<span class="c1">#             </span>
<span class="c1">#         elif type_ == &#39;lines&#39;:</span>
<span class="c1">#             self.setWindowTitle(&#39;Edit Lines&#39;)</span>
<span class="c1"># </span>
<span class="c1">#             max_n = max(self.xs.keys()) # do not select nonexisting nodes</span>
<span class="c1">#             self.start_input = QSpinBox()</span>
<span class="c1">#             self.start_input.setRange(0, max_n)</span>
<span class="c1">#             self.end_input = QSpinBox()</span>
<span class="c1">#             self.end_input.setRange(0, max_n)</span>
<span class="c1"># </span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;start node&#39;), 0, 0)</span>
<span class="c1">#             inp_box.addWidget(self.start_input, 1, 0)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;end node&#39;), 0, 1)</span>
<span class="c1">#             inp_box.addWidget(self.end_input, 1, 1)</span>
<span class="c1"># </span>
<span class="c1">#             self.add_button.released.connect(self.add_line)</span>
<span class="c1"># </span>
<span class="c1">#             self.coordinates_list = QTableWidget(0, 2)</span>
<span class="c1"># </span>
<span class="c1">#             load_button = QPushButton(&#39;Load Beamfile&#39;)</span>
<span class="c1">#             load_button.released.connect(self.load_new_lines)</span>
<span class="c1">#             </span>
<span class="c1">#         elif type_ == &#39;master_slaves&#39;:</span>
<span class="c1">#             self.setWindowTitle(&#39;Edit Master-Slave Definitions&#39;)</span>
<span class="c1"># </span>
<span class="c1">#             max_n = max(self.xs.keys()) # do not select nonexisting nodes</span>
<span class="c1">#             self.master_node = QSpinBox()</span>
<span class="c1">#             self.master_node.setRange(0, max_n)</span>
<span class="c1">#             self.master_x = QDoubleSpinBox()</span>
<span class="c1">#             self.master_x.setRange(-100, 100)</span>
<span class="c1">#             self.master_y = QDoubleSpinBox()</span>
<span class="c1">#             self.master_y.setRange(-100, 100)</span>
<span class="c1">#             self.master_z = QDoubleSpinBox()</span>
<span class="c1">#             self.master_z.setRange(-100, 100)</span>
<span class="c1">#             self.slave_node = QSpinBox()</span>
<span class="c1">#             self.slave_node.setRange(0, max_n)</span>
<span class="c1">#             self.slave_x = QDoubleSpinBox()</span>
<span class="c1">#             self.slave_x.setRange(-100, 100)</span>
<span class="c1">#             self.slave_y = QDoubleSpinBox()</span>
<span class="c1">#             self.slave_y.setRange(-100, 100)</span>
<span class="c1">#             self.slave_z = QDoubleSpinBox()</span>
<span class="c1">#             self.slave_z.setRange(-100, 100)</span>
<span class="c1"># </span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;master node&#39;), 0, 0)</span>
<span class="c1">#             inp_box.addWidget(self.master_node, 1, 0)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;master x&#39;), 0, 1)</span>
<span class="c1">#             inp_box.addWidget(self.master_x, 1, 1)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;master y&#39;), 0, 2)</span>
<span class="c1">#             inp_box.addWidget(self.master_y, 1, 2)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;master z&#39;), 0, 3)</span>
<span class="c1">#             inp_box.addWidget(self.master_z, 1, 3)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;slave node&#39;), 0, 4)</span>
<span class="c1">#             inp_box.addWidget(self.slave_node, 1, 4)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;slave x&#39;), 0, 5)</span>
<span class="c1">#             inp_box.addWidget(self.slave_x, 1, 5)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;slave y&#39;), 0, 6)</span>
<span class="c1">#             inp_box.addWidget(self.slave_y, 1, 6)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;slave z&#39;), 0, 7)</span>
<span class="c1">#             inp_box.addWidget(self.slave_z, 1, 7)</span>
<span class="c1"># </span>
<span class="c1">#             self.add_button.released.connect(self.add_master_slave)</span>
<span class="c1"># </span>
<span class="c1">#             self.coordinates_list = QTableWidget(0, 8)</span>
<span class="c1"># </span>
<span class="c1">#             load_button = QPushButton(&#39;Load Master-Slave-File&#39;)</span>
<span class="c1">#             load_button.released.connect(self.load_new_master_slave)</span>
<span class="c1"># </span>
<span class="c1">#         elif type_ == &#39;chan_dofs&#39;:</span>
<span class="c1">#             self.setWindowTitle(&#39;Edit Channel-DOF Assignmnents&#39;)</span>
<span class="c1"># </span>
<span class="c1">#             max_n = max(self.xs.keys())</span>
<span class="c1">#             self.chan_input = QSpinBox()</span>
<span class="c1">#             self.chan_input.setRange(0, 1000)</span>
<span class="c1">#             self.node_input = QSpinBox()</span>
<span class="c1">#             self.node_input.setRange(0, max_n)</span>
<span class="c1">#             self.x_input = QDoubleSpinBox()</span>
<span class="c1">#             self.x_input.setRange(-1000, 1000)</span>
<span class="c1">#             self.y_input = QDoubleSpinBox()</span>
<span class="c1">#             self.y_input.setRange(-1000, 1000)</span>
<span class="c1">#             self.z_input = QDoubleSpinBox()</span>
<span class="c1">#             self.z_input.setRange(-1000, 1000)</span>
<span class="c1"># </span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;channel&#39;), 0, 0)</span>
<span class="c1">#             inp_box.addWidget(self.chan_input, 1, 0)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;node&#39;), 0, 1)</span>
<span class="c1">#             inp_box.addWidget(self.node_input, 1, 1)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;x ampl.&#39;), 0, 2)</span>
<span class="c1">#             inp_box.addWidget(self.x_input, 1, 2)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;y ampl.&#39;), 0, 3)</span>
<span class="c1">#             inp_box.addWidget(self.y_input, 1, 3)</span>
<span class="c1">#             inp_box.addWidget(QLabel(&#39;z ampl.&#39;), 0, 4)</span>
<span class="c1">#             inp_box.addWidget(self.z_input, 1, 4)</span>
<span class="c1"># </span>
<span class="c1">#             self.add_button.released.connect(self.add_chan_dof)</span>
<span class="c1"># </span>
<span class="c1">#             self.coordinates_list = QTableWidget(0, 5)</span>
<span class="c1"># </span>
<span class="c1">#             load_button = QPushButton(&#39;Load Channel DOF File&#39;)</span>
<span class="c1">#             load_button.released.connect(self.load_new_chan_dof)</span>
<span class="c1"># </span>
<span class="c1">#         remove_button = QPushButton(&#39;remove&#39;)</span>
<span class="c1">#         remove_button.released.connect(self.remove_rows)</span>
<span class="c1"># </span>
<span class="c1">#         button_box_top = QHBoxLayout()</span>
<span class="c1">#         button_box_top.addWidget(remove_button)</span>
<span class="c1">#         button_box_top.addStretch()</span>
<span class="c1">#         button_box_top.addWidget(self.add_button)</span>
<span class="c1"># </span>
<span class="c1">#         self.coordinates_list.horizontalHeader().hide()</span>
<span class="c1">#         self.coordinates_list.verticalHeader().hide()</span>
<span class="c1">#         self.coordinates_list.setShowGrid(False)</span>
<span class="c1">#         for column in range(self.coordinates_list.columnCount()):</span>
<span class="c1">#             self.coordinates_list.setColumnWidth(column, 50)</span>
<span class="c1">#         self.coordinates_list.setSelectionBehavior(</span>
<span class="c1">#             QAbstractItemView.SelectRows)</span>
<span class="c1"># </span>
<span class="c1">#         clear_button = QPushButton(&#39;Clear&#39;)</span>
<span class="c1">#         clear_button.released.connect(self.clear_list)</span>
<span class="c1"># </span>
<span class="c1">#         save_button = QPushButton(&#39;Save&#39;)</span>
<span class="c1">#         save_button.released.connect(self.save_file)</span>
<span class="c1"># </span>
<span class="c1">#         close_button = QPushButton(&#39;Close&#39;)</span>
<span class="c1">#         close_button.released.connect(self.close_return)</span>
<span class="c1"># </span>
<span class="c1">#         button_box_bottom = QHBoxLayout()</span>
<span class="c1">#         button_box_bottom.addWidget(clear_button)</span>
<span class="c1">#         button_box_bottom.addWidget(load_button)</span>
<span class="c1">#         button_box_bottom.addWidget(save_button)</span>
<span class="c1">#         button_box_bottom.addWidget(close_button)</span>
<span class="c1"># </span>
<span class="c1">#         vbox = QVBoxLayout()</span>
<span class="c1">#         vbox.addLayout(inp_box)</span>
<span class="c1">#         vbox.addLayout(button_box_top)</span>
<span class="c1">#         vbox.addWidget(self.coordinates_list, stretch=1)</span>
<span class="c1">#         vbox.addLayout(button_box_bottom)</span>
<span class="c1"># </span>
<span class="c1">#         main_frame.setLayout(vbox)</span>
<span class="c1"># </span>
<span class="c1">#         self.setCentralWidget(main_frame)</span>
<span class="c1">#         self.show()</span>
<span class="c1">#         </span>
<span class="c1">#     def keyPressEvent(self, e):        </span>
<span class="c1">#         &quot;define which signals will be emitted if a specified key is pressed&quot;</span>
<span class="c1">#         </span>
<span class="c1">#         #inherit the original method from QMainWindows to not break keyboard navigation</span>
<span class="c1">#         super(GeometryCreator, self).keyPressEvent(e)</span>
<span class="c1">#         if e.key() == Qt.Key_Enter: </span>
<span class="c1">#             self.add_button.released.emit()</span>
<span class="c1">#                </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(int, int, int)</span>
<span class="c1">#     def add_node(self, x=None, y=None, z=None, node=None):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         add a node either programatically by passing the corrdinates</span>
<span class="c1">#         or via a signal from a button, such that the coordinates will be</span>
<span class="c1">#         read from the input widgets</span>
<span class="c1">#         coordinates will be added to the list widget, to the internal</span>
<span class="c1">#         node table and sent via a signal</span>
<span class="c1">#         x, y, z = float</span>
<span class="c1">#         node = int</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         if x is None:</span>
<span class="c1">#             x = self.x_input.value()</span>
<span class="c1">#         else:</span>
<span class="c1">#             x = float(x)</span>
<span class="c1">#         if y is None:</span>
<span class="c1">#             y = self.y_input.value()</span>
<span class="c1">#         else:</span>
<span class="c1">#             y = float(y)</span>
<span class="c1">#         if z is None:</span>
<span class="c1">#             z = self.z_input.value()</span>
<span class="c1">#         else:</span>
<span class="c1">#             z = float(z)</span>
<span class="c1"># </span>
<span class="c1">#         rows = self.coordinates_list.rowCount()</span>
<span class="c1">#         self.coordinates_list.insertRow(rows)</span>
<span class="c1"># </span>
<span class="c1">#         if node is None:</span>
<span class="c1">#             node = int(rows)</span>
<span class="c1">#         else:</span>
<span class="c1">#             node = int(float(node))</span>
<span class="c1"># </span>
<span class="c1">#         for col, val in enumerate([node, x, y, z]):</span>
<span class="c1">#             if isinstance(val, int):</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:d}&#39;.format(val))</span>
<span class="c1">#             else:</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:2.3f}&#39;.format(val))</span>
<span class="c1">#             item.setFlags(item.flags() ^ Qt.ItemIsEditable)</span>
<span class="c1">#             self.coordinates_list.setItem(rows, col, item)</span>
<span class="c1">#         self.coordinates_list.resizeRowsToContents()</span>
<span class="c1"># </span>
<span class="c1">#         self.xs[node], self.ys[node], self.zs[node] = x, y, z</span>
<span class="c1"># </span>
<span class="c1">#         self.node_added.emit(x, y, z, node)</span>
<span class="c1">#         </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(tuple)</span>
<span class="c1">#     def add_line(self, line=None):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         add a line either programatically by passing the line nodes</span>
<span class="c1">#         or via a signal from a button, such that the coordinates will be</span>
<span class="c1">#         read from the input widgets</span>
<span class="c1">#         line nodes (start node and end node; must be existing)</span>
<span class="c1">#         will be added to the list widget, to the internal lines table</span>
<span class="c1">#         and sent via a signal</span>
<span class="c1">#         line = (start_node [int], end_node [int])</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         if line is None:</span>
<span class="c1">#             n_start = self.start_input.value()</span>
<span class="c1">#             n_end = self.end_input.value()</span>
<span class="c1">#             line = (n_start, n_end)</span>
<span class="c1"># </span>
<span class="c1">#         assert isinstance(line, (tuple, list))</span>
<span class="c1">#         assert len(line) == 2</span>
<span class="c1">#         for value in line:</span>
<span class="c1">#             assert isinstance(value, int)</span>
<span class="c1"># </span>
<span class="c1">#         n_start, n_end = line</span>
<span class="c1"># </span>
<span class="c1">#         assert len(self.xs) == len(self.ys) == len(self.zs)</span>
<span class="c1">#         assert max(list(self.xs.keys())) &gt;= n_start</span>
<span class="c1">#         assert max(list(self.xs.keys())) &gt;= n_end</span>
<span class="c1"># </span>
<span class="c1">#         rows = self.coordinates_list.rowCount()</span>
<span class="c1">#         self.coordinates_list.insertRow(rows)</span>
<span class="c1"># </span>
<span class="c1">#         for col, val in enumerate(line):</span>
<span class="c1">#             item = QTableWidgetItem(&#39;{:d}&#39;.format(val))</span>
<span class="c1">#             item.setFlags(item.flags() ^ Qt.ItemIsEditable)</span>
<span class="c1">#             self.coordinates_list.setItem(rows, col, item)</span>
<span class="c1">#         self.coordinates_list.resizeRowsToContents()</span>
<span class="c1"># </span>
<span class="c1">#         while len(self.lines) &lt;= rows:</span>
<span class="c1">#             self.lines.append((0, 0))</span>
<span class="c1">#         self.lines[rows] = line</span>
<span class="c1">#         self.line_added.emit(line, rows)</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(int, float, float, float, int, float, float, float)</span>
<span class="c1">#     def add_master_slave(self, i_m=None,  x_m=None,  y_m=None,  z_m=None, </span>
<span class="c1">#                                i_sl=None, x_sl=None, y_sl=None, z_sl=None):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         add a master slave definition either programatically by passing</span>
<span class="c1">#         the nodes and directional factors or via a signal from a button,</span>
<span class="c1">#         such that these values will be read from the input widgets</span>
<span class="c1">#         master-slave definitions will be added to the list widget, to </span>
<span class="c1">#         the internal master-slave table and sent via a signal</span>
<span class="c1">#         i_m, i_sl = node_num [int]</span>
<span class="c1">#         x_m, y_m, z_m, x_sl, y_sl, z_sl = float</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         if i_m is None:</span>
<span class="c1">#             i_m = self.master_node.value()</span>
<span class="c1">#         i_m = int(float(i_m))</span>
<span class="c1">#         if x_m is None:</span>
<span class="c1">#             x_m = self.master_x.value()</span>
<span class="c1">#         x_m = float(x_m)</span>
<span class="c1">#         if y_m is None:</span>
<span class="c1">#             y_m = self.master_y.value()</span>
<span class="c1">#         y_m = float(y_m)</span>
<span class="c1">#         if z_m is None:</span>
<span class="c1">#             z_m = self.master_z.value()</span>
<span class="c1">#         z_m = float(z_m)</span>
<span class="c1">#         if i_sl is None:</span>
<span class="c1">#             i_sl = self.slave_node.value()</span>
<span class="c1">#         i_sl = int(float(i_sl))</span>
<span class="c1">#         if x_sl is None:</span>
<span class="c1">#             x_sl = self.slave_x.value()</span>
<span class="c1">#         x_sl = float(x_sl)</span>
<span class="c1">#         if y_sl is None:</span>
<span class="c1">#             y_sl = self.slave_y.value()</span>
<span class="c1">#         y_sl = float(y_sl)</span>
<span class="c1">#         if z_sl is None:</span>
<span class="c1">#             z_sl = self.slave_z.value()</span>
<span class="c1">#         z_sl = float(z_sl)</span>
<span class="c1"># </span>
<span class="c1">#         if x_m == y_m == z_m == 0 or x_sl == y_sl == z_sl == 0:</span>
<span class="c1">#             QMessageBox.warning(</span>
<span class="c1">#                 self, &#39;Warning&#39;, &#39;You have to select at least one direction&#39; </span>
<span class="c1">#                 &#39;for each of master and slave to be non-zero! Will omit now!&#39;)</span>
<span class="c1">#             return  # arrows of zero length cause error messages</span>
<span class="c1"># </span>
<span class="c1">#         rows = self.coordinates_list.rowCount()</span>
<span class="c1">#         self.coordinates_list.insertRow(rows)</span>
<span class="c1"># </span>
<span class="c1">#         for col, val in enumerate([i_m,  x_m,  y_m,  z_m, </span>
<span class="c1">#                                    i_sl, x_sl, y_sl, z_sl]):</span>
<span class="c1">#             if isinstance(val, int): # e.g. node</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:d}&#39;.format(val))</span>
<span class="c1">#             else: # e.g. DOF</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:2.3f}&#39;.format(val))</span>
<span class="c1">#             item.setFlags(item.flags() ^ Qt.ItemIsEditable)</span>
<span class="c1">#             self.coordinates_list.setItem(rows, col, item)</span>
<span class="c1">#         self.coordinates_list.resizeRowsToContents()</span>
<span class="c1"># </span>
<span class="c1">#         while len(self.master_slaves) &lt;= rows:</span>
<span class="c1">#             self.master_slaves.append((0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0))</span>
<span class="c1">#         self.master_slaves[rows] = [i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl]</span>
<span class="c1"># </span>
<span class="c1">#         self.slave_added.emit(i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl, rows)</span>
<span class="c1">#  </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(int, tuple)</span>
<span class="c1">#     def add_chan_dof(self, chan=None, node=None, dof=None):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         add a channel - DOF assignment either programatically by passing</span>
<span class="c1">#         the channel, node and direction information or via a signal from</span>
<span class="c1">#         a button, such that these values will be read from the input widgets</span>
<span class="c1">#         values will be added to the list widget, to the internal </span>
<span class="c1">#         channel-dof table and sent via a signal</span>
<span class="c1">#         chan = int</span>
<span class="c1">#         node = int</span>
<span class="c1">#         dof = (x_ampli [float], y_ampli [float], z_ampli [float])</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         if chan is None:</span>
<span class="c1">#             chan = self.chan_input.value()</span>
<span class="c1">#             self.chan_input.setValue(chan + 1)</span>
<span class="c1">#         else:</span>
<span class="c1">#             chan = int(float(chan))</span>
<span class="c1">#         if node is None:</span>
<span class="c1">#             node = self.node_input.value()</span>
<span class="c1">#         else:</span>
<span class="c1">#             node = int(float(node))</span>
<span class="c1">#         if dof is None:</span>
<span class="c1">#             x_amp = self.x_input.value()</span>
<span class="c1">#             y_amp = self.y_input.value()</span>
<span class="c1">#             z_amp = self.z_input.value()</span>
<span class="c1">#             dof = (x_amp, y_amp, z_amp)</span>
<span class="c1">#         else:</span>
<span class="c1">#             assert isinstance(dof, (tuple, list))</span>
<span class="c1">#             assert len(dof) == 3</span>
<span class="c1">#             for amp in dof:</span>
<span class="c1">#                 assert isinstance(amp, (int, float))</span>
<span class="c1"># </span>
<span class="c1">#         if dof[0] == dof[1] == dof[2] == 0:</span>
<span class="c1">#             QMessageBox.warning(</span>
<span class="c1">#                 self, &#39;Warning&#39;, &#39;You have to select at least one direction&#39;</span>
<span class="c1">#                 &#39;for amplification to be non-zero! Will omit now!&#39;)</span>
<span class="c1">#             return  # arrows of zero length cause error messages</span>
<span class="c1"># </span>
<span class="c1">#         rows = self.coordinates_list.rowCount()</span>
<span class="c1">#         self.coordinates_list.insertRow(rows)</span>
<span class="c1"># </span>
<span class="c1">#         for col, val in enumerate([chan, node] + list(dof)):</span>
<span class="c1">#             if isinstance(val, int):</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:d}&#39;.format(val))</span>
<span class="c1">#             else:</span>
<span class="c1">#                 item = QTableWidgetItem(&#39;{:2.3f}&#39;.format(val))</span>
<span class="c1">#             item.setFlags(item.flags() ^ Qt.ItemIsEditable)</span>
<span class="c1">#             self.coordinates_list.setItem(rows, col, item)</span>
<span class="c1">#         self.coordinates_list.resizeRowsToContents()</span>
<span class="c1"># </span>
<span class="c1">#         while len(self.chan_dofs) &lt;= rows:</span>
<span class="c1">#             self.chan_dofs.append((0, 0, (0.0, 0.0, 0.0)))</span>
<span class="c1">#         self.chan_dofs[rows] = (chan, node, dof)</span>
<span class="c1">#         </span>
<span class="c1">#         self.chan_dof_added.emit(chan, node, dof, rows)</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def load_new_nodes(self):</span>
<span class="c1">#         self.clear_list()</span>
<span class="c1">#         self.load_nodes()</span>
<span class="c1">#         </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def load_new_lines(self):</span>
<span class="c1">#         self.clear_list()</span>
<span class="c1">#         self.load_lines()</span>
<span class="c1">#         </span>
<span class="c1">#     @pyqtSlot()    </span>
<span class="c1">#     def load_new_master_slave(self):</span>
<span class="c1">#         self.clear_list()</span>
<span class="c1">#         self.load_master_slave()</span>
<span class="c1">#  </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def load_new_chan_dof(self):</span>
<span class="c1">#         self.clear_list()</span>
<span class="c1">#         self.load_chan_dof()</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(str)</span>
<span class="c1">#     @pyqtSlot(str, bool)</span>
<span class="c1">#     def load_nodes(self, filename=&#39;&#39;, silent=False):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         this is an overloaded function with the following functionalities:</span>
<span class="c1">#         - create a new set of nodes via a GUI</span>
<span class="c1">#         - edit an already loaded/created set of nodes via a GUI</span>
<span class="c1">#         - load an existing set of nodes</span>
<span class="c1">#             - and show/edit it </span>
<span class="c1">#             - load it silently</span>
<span class="c1">#         filename = str (should exist and point to a whitespace </span>
<span class="c1">#             delimited ascii file (see class description)</span>
<span class="c1">#         silent = bool (if False show the GUI)</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         def csv_loader(filename):</span>
<span class="c1">#             xs, ys, zs = {}, {}, {} # dictionary (why? -&gt; see __init__)</span>
<span class="c1">#             with open(filename, &#39;r&#39;) as f:</span>
<span class="c1">#                 for line in csv.reader(f, delimiter=&#39; &#39;, skipinitialspace=True):</span>
<span class="c1">#                     if not line:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     node, x, y, z =  \</span>
<span class="c1">#                         [float(line[i]) for i in range(4)]  # cut trailing empty columns</span>
<span class="c1">#                     node = int(node)</span>
<span class="c1">#                     xs[node], ys[node], zs[node] = x, y, z</span>
<span class="c1">#             return xs, ys, zs</span>
<span class="c1"># </span>
<span class="c1">#         self.show_creation_widget(type_=&#39;nodes&#39;)</span>
<span class="c1">#         xs, ys, zs = {}, {}, {} # dictionary (why? -&gt; see __init__)</span>
<span class="c1">#         if self.xs and self.ys and self.zs:  # edit an existing grid</span>
<span class="c1">#             xs, ys, zs = self.xs, self.ys, self.zs</span>
<span class="c1">#         elif not os.path.exists(filename):  # load grid by button request</span>
<span class="c1">#             filename = QFileDialog.getOpenFileName(</span>
<span class="c1">#                 caption=&#39;Open Gridfile&#39;, filter=&quot;*.asc&quot;, directory=self.last_path)</span>
<span class="c1">#             self.last_path = os.path.dirname(filename)</span>
<span class="c1">#         # load grid by filename; continue button loading</span>
<span class="c1">#         if os.path.exists(filename):</span>
<span class="c1">#             xs, ys, zs = csv_loader(filename)</span>
<span class="c1">#         # add nodes to the table, to the plot and to the coordinates lists</span>
<span class="c1">#         for key in xs.keys():</span>
<span class="c1">#             self.add_node(xs[key], ys[key], zs[key], key)</span>
<span class="c1">#         if silent and xs and ys and zs:  # don&#39;t show the GUI</span>
<span class="c1">#             self.hide()</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(str)</span>
<span class="c1">#     @pyqtSlot(str, bool)</span>
<span class="c1">#     def load_lines(self, filename=&#39;&#39;, silent=False):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         this is an overloaded function with the following functionalities:</span>
<span class="c1">#         - create a new set of lines via a GUI</span>
<span class="c1">#         - edit an already loaded/created set of lines via a GUI</span>
<span class="c1">#         - load an existing set of lines</span>
<span class="c1">#             - and show/edit it </span>
<span class="c1">#             - load it silently</span>
<span class="c1">#         filename = str (should exist and point to a whitespace </span>
<span class="c1">#             delimited ascii file (see class description)</span>
<span class="c1">#         silent = bool (if False show the GUI)</span>
<span class="c1">#         </span>
<span class="c1">#         nodes have to exis before loading/creating lines</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         def csv_loader(filename):</span>
<span class="c1">#             lines = []</span>
<span class="c1">#             with open(filename, &#39;r&#39;) as f:</span>
<span class="c1">#                 for line in csv.reader(f, delimiter=&#39; &#39;, skipinitialspace=True):</span>
<span class="c1">#                     if not line:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     node_start, node_end = \</span>
<span class="c1">#                         [int(float(line[i])) for i in range(2)]</span>
<span class="c1">#                     lines.append((node_start, node_end))</span>
<span class="c1">#             return lines</span>
<span class="c1"># </span>
<span class="c1">#         try:</span>
<span class="c1">#             self.return_to_func.disconnect(self.load_lines)</span>
<span class="c1">#         except TypeError: # signal is not connected to slot</span>
<span class="c1">#             pass</span>
<span class="c1">#         </span>
<span class="c1">#         # check if nodes are present</span>
<span class="c1">#         if not self.xs or not self.ys or not self.zs:</span>
<span class="c1">#             self.return_to_func.connect(self.load_lines)</span>
<span class="c1">#             QMessageBox.information(</span>
<span class="c1">#                 self, &#39;Information&#39;, </span>
<span class="c1">#                 &#39;No Nodes found! Create or load nodes first!&#39;)</span>
<span class="c1">#             self.load_nodes()</span>
<span class="c1">#             return</span>
<span class="c1"># </span>
<span class="c1">#         self.show_creation_widget(type_=&#39;lines&#39;)</span>
<span class="c1">#         lines = []</span>
<span class="c1">#         if self.lines:  # edit  existing lines</span>
<span class="c1">#             lines = self.lines</span>
<span class="c1">#         elif not os.path.exists(filename):  # load lines by button request</span>
<span class="c1">#             filename = QFileDialog.getOpenFileName(</span>
<span class="c1">#                 caption=&#39;Open Beam&#39;, filter=&quot;*.asc&quot;, directory=self.last_path)</span>
<span class="c1">#             self.last_path = os.path.dirname(filename)</span>
<span class="c1"># </span>
<span class="c1">#         # load lines by filename, continue button loading</span>
<span class="c1">#         if os.path.exists(filename):</span>
<span class="c1">#             lines = csv_loader(filename)</span>
<span class="c1">#         # add lines to the table, to the plot and to the coordinates lists</span>
<span class="c1">#         for line in lines:</span>
<span class="c1">#             self.add_line(line)</span>
<span class="c1">#         if silent and lines:  # don&#39;t show the GUI</span>
<span class="c1">#             self.hide()</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(str)</span>
<span class="c1">#     @pyqtSlot(str, bool)</span>
<span class="c1">#     def load_master_slave(self, filename=&#39;&#39;, silent=False):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         this is an overloaded function with the following functionalities:</span>
<span class="c1">#         - create a new set of master slave definitions via a GUI</span>
<span class="c1">#         - edit an already loaded/created set of master slave definitions via a GUI</span>
<span class="c1">#         - load an existing set of master slave definitions</span>
<span class="c1">#             - and show/edit it </span>
<span class="c1">#             - load it silently</span>
<span class="c1">#         filename = str (should exist and point to a whitespace </span>
<span class="c1">#             delimited ascii file (see class description)</span>
<span class="c1">#         silent = bool (if False show the GUI)</span>
<span class="c1">#         </span>
<span class="c1">#         nodes have to exist before loading/creating master slave definitions</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         def csv_loader(filename):</span>
<span class="c1">#             master_slaves = []</span>
<span class="c1">#             with open(filename, &#39;r&#39;) as f:</span>
<span class="c1">#                 reader = csv.reader(f, delimiter=&#39; &#39;, skipinitialspace=True)</span>
<span class="c1">#                 for line in reader:</span>
<span class="c1">#                     if not line:</span>
<span class="c1">#                         continue</span>
<span class="c1">#                     i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl = \</span>
<span class="c1">#                             [float(line[i]) for i in range(8)]</span>
<span class="c1">#                     i_m, i_sl = [int(node) for node in [i_m, i_sl]]</span>
<span class="c1">#                     master_slaves.append(</span>
<span class="c1">#                         (i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl))</span>
<span class="c1">#             return master_slaves</span>
<span class="c1"># </span>
<span class="c1">#         try:</span>
<span class="c1">#             self.return_to_func.disconnect(self.load_master_slave)</span>
<span class="c1">#         except TypeError: # signal is not connected to slot</span>
<span class="c1">#             pass</span>
<span class="c1"># </span>
<span class="c1">#         # check if nodes are present</span>
<span class="c1">#         if not self.xs or not self.ys or not self.zs:</span>
<span class="c1">#             self.return_to_func.connect(self.load_master_slave)</span>
<span class="c1">#             QMessageBox.information(</span>
<span class="c1">#                 self, &#39;Information&#39;, </span>
<span class="c1">#                 &#39;No Nodes found! Create or load nodes first!&#39;)</span>
<span class="c1">#             self.load_nodes()</span>
<span class="c1">#             return</span>
<span class="c1"># </span>
<span class="c1">#         self.show_creation_widget(type_=&#39;master_slaves&#39;)</span>
<span class="c1">#         master_slaves = []</span>
<span class="c1">#         if self.master_slaves:  # edit  existing master_slaves</span>
<span class="c1">#             master_slaves = self.master_slaves</span>
<span class="c1">#         elif not os.path.exists(filename):  # load master_slaves by button request</span>
<span class="c1">#             filename = QFileDialog.getOpenFileName(</span>
<span class="c1">#                 caption=&#39;Open Master-Slave-File&#39;, </span>
<span class="c1">#                 filter=&quot;*.asc&quot;, directory=self.last_path)</span>
<span class="c1">#             self.last_path = os.path.dirname(filename)</span>
<span class="c1"># </span>
<span class="c1">#         # load master_slaves by filename; continue button loading</span>
<span class="c1">#         if os.path.exists(filename):</span>
<span class="c1">#             master_slaves = csv_loader(filename)</span>
<span class="c1">#         # add master_slaves to the table, to the plot and to the list</span>
<span class="c1">#         for master_slave in master_slaves:</span>
<span class="c1">#             self.add_master_slave(*master_slave)</span>
<span class="c1">#         if silent and master_slaves:  # don&#39;t show the GUI</span>
<span class="c1">#             self.hide()</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     @pyqtSlot(str)</span>
<span class="c1">#     @pyqtSlot(str, bool)</span>
<span class="c1">#     def load_chan_dof(self, filename=&#39;&#39;, silent=False):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         this is an overloaded function with the following functionalities:</span>
<span class="c1">#         - create a new set of channel-DOF-assignments via a GUI</span>
<span class="c1">#         - edit an already loaded/created set of channel-DOF-assignments via a GUI</span>
<span class="c1">#         - load an existing set of master slave definitions</span>
<span class="c1">#             - and show/edit it </span>
<span class="c1">#             - load it silently</span>
<span class="c1">#         filename = str (should exist and point to a whitespace </span>
<span class="c1">#             delimited ascii file (see class description)</span>
<span class="c1">#         silent = bool (if False show the GUI)</span>
<span class="c1">#         </span>
<span class="c1">#         nodes have to exist before loading/creating channel-DOF-assignments</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         def csv_loader(filename):</span>
<span class="c1">#             chan_dofs = []</span>
<span class="c1">#             with open(filename, &#39;r&#39;) as f:</span>
<span class="c1">#                 for line in csv.reader(f, delimiter=&#39; &#39;, skipinitialspace=True):</span>
<span class="c1">#                     if not line:</span>
<span class="c1">#                         continue  # skip empty lines</span>
<span class="c1">#                     chan, node, x_amp, y_amp, z_amp = \</span>
<span class="c1">#                         [float(line[i]) for i in range(5)]  # cut trailing empties</span>
<span class="c1">#                     x_amp = int(x_amp * 10**3)/10**3</span>
<span class="c1">#                     y_amp = int(y_amp * 10**3)/10**3</span>
<span class="c1">#                     z_amp = int(z_amp * 10**3)/10**3</span>
<span class="c1">#                     </span>
<span class="c1">#                     chan_dofs.append(</span>
<span class="c1">#                         (int(chan), int(node), (x_amp, y_amp, z_amp)))</span>
<span class="c1">#             return chan_dofs</span>
<span class="c1">#         </span>
<span class="c1">#         def json_loader(filename):</span>
<span class="c1">#             import json</span>
<span class="c1">#             chan_dofs_file=json.load(open(filename))</span>
<span class="c1">#             </span>
<span class="c1">#             chan_dofs=[]</span>
<span class="c1">#             if isinstance(chan_dofs_file, dict):</span>
<span class="c1">#                 ok=False</span>
<span class="c1">#                 if len(chan_dofs_file.keys())&gt;1:</span>
<span class="c1">#                     while not ok:</span>
<span class="c1">#                         measurement_name, ok = QInputDialog.getText(self, &#39;Input Dialog&#39;, </span>
<span class="c1">#                         &#39;Choose measurement_name: {}&#39;.format(str(list(chan_dofs_file.keys()))))</span>
<span class="c1">#                 else: measurement_name = list(chan_dofs_file.keys())[0]</span>
<span class="c1">#                 chan_dofs_file = chan_dofs_file[measurement_name]</span>
<span class="c1">#                 </span>
<span class="c1">#             for chan, node, az, elev in chan_dofs_file:</span>
<span class="c1">#                 az = az/180*np.pi</span>
<span class="c1">#                 elev=elev/180*np.pi</span>
<span class="c1">#                 x_amp=1*np.cos(elev)*np.cos(az) # for elevation angle defined from XY-plane up</span>
<span class="c1">#                 #x=r*numpy.sin(elev)*numpy.cos(az) # for elevation angle defined from Z-axis down</span>
<span class="c1">#                 y_amp=1*np.cos(elev)*np.sin(az) # for elevation angle defined from XY-plane up</span>
<span class="c1">#                 #y=r*numpy.sin(elev)*numpy.sin(az)# for elevation angle defined from Z-axis down</span>
<span class="c1">#                 z_amp=1*np.sin(elev)</span>
<span class="c1">#                 chan_dofs.append(</span>
<span class="c1">#                         (int(chan), int(node), (x_amp, y_amp, z_amp)))</span>
<span class="c1">#             return chan_dofs</span>
<span class="c1">#         </span>
<span class="c1">#         def numpy_loader(filename):</span>
<span class="c1">#             chan_dofs_file = np.load(filename)</span>
<span class="c1">#             chan_dofs=[]</span>
<span class="c1">#             for chan, node, az, elev in chan_dofs_file:</span>
<span class="c1">#                 az = az/180*np.pi</span>
<span class="c1">#                 elev=elev/180*np.pi</span>
<span class="c1">#                 x_amp=1*np.cos(elev)*np.cos(az) # for elevation angle defined from XY-plane up</span>
<span class="c1">#                 #x=r*numpy.sin(elev)*numpy.cos(az) # for elevation angle defined from Z-axis down</span>
<span class="c1">#                 y_amp=1*np.cos(elev)*np.sin(az) # for elevation angle defined from XY-plane up</span>
<span class="c1">#                 #y=r*numpy.sin(elev)*numpy.sin(az)# for elevation angle defined from Z-axis down</span>
<span class="c1">#                 z_amp=1*np.sin(elev)</span>
<span class="c1">#                 chan_dofs.append(</span>
<span class="c1">#                         (int(chan), int(node), (x_amp, y_amp, z_amp)))</span>
<span class="c1">#             return chan_dofs</span>
<span class="c1">#                         </span>
<span class="c1">#         try:</span>
<span class="c1">#             self.return_to_func.disconnect(self.load_chan_dof)</span>
<span class="c1">#         except TypeError: # signal is not connected to slot</span>
<span class="c1">#             pass</span>
<span class="c1"># </span>
<span class="c1">#         # check if nodes are present</span>
<span class="c1">#         if not self.xs or not self.ys or not self.zs:</span>
<span class="c1">#             self.return_to_func.connect(self.load_chan_dof)</span>
<span class="c1">#             QMessageBox.information(</span>
<span class="c1">#                 self, &#39;Information&#39;, </span>
<span class="c1">#                 &#39;No nodes found! Create or load nodes first!&#39;)</span>
<span class="c1">#             self.load_nodes()</span>
<span class="c1">#             return</span>
<span class="c1"># </span>
<span class="c1">#         self.show_creation_widget(type_=&#39;chan_dofs&#39;)</span>
<span class="c1">#         chan_dofs = []</span>
<span class="c1"># </span>
<span class="c1">#         if self.chan_dofs:  # edit existing channel-DOF-assignments</span>
<span class="c1">#             chan_dofs = self.chan_dofs</span>
<span class="c1">#         elif not os.path.exists(filename):  # load channel-DOF-assignments by button request</span>
<span class="c1">#             filename = QFileDialog.getOpenFileName(</span>
<span class="c1">#                 caption=&#39;Open Channel DOF Assignment File&#39;, </span>
<span class="c1">#                 #filter=&quot;*.asc&quot;,</span>
<span class="c1">#                  directory=self.last_path)</span>
<span class="c1">#             self.last_path = os.path.dirname(filename)</span>
<span class="c1"># </span>
<span class="c1">#         # load channel-DOF-assignments by filename, continue button loading</span>
<span class="c1">#         if os.path.exists(filename):</span>
<span class="c1">#             try:</span>
<span class="c1">#                 chan_dofs = csv_loader(filename)</span>
<span class="c1">#             except:</span>
<span class="c1">#                 try:</span>
<span class="c1">#                     chan_dofs = json_loader(filename)</span>
<span class="c1">#                 except:</span>
<span class="c1">#                     chan_dofs = numpy_loader(filename)</span>
<span class="c1">#         # add channel-DOF-assignments to the table, to the plot and to the lists</span>
<span class="c1">#         for chan, node, dof in chan_dofs:</span>
<span class="c1">#             self.add_chan_dof(chan, node, dof)</span>
<span class="c1">#         if silent and chan_dofs:  # don&#39;t show the GUI</span>
<span class="c1">#             self.hide()</span>
<span class="c1">#             </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def remove_rows(self, rows=None):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         remove rows from the listwidget either pass a list-of-int or call </span>
<span class="c1">#         via a signal from a button and get selected rows from the list widget</span>
<span class="c1">#         based on the number of columns in the list widget it is identified</span>
<span class="c1">#         what type of geometry is currently edited </span>
<span class="c1">#         - columns = 4 -&gt; nodes</span>
<span class="c1">#         - columns = 2 -&gt; lines</span>
<span class="c1">#         - columns = 8 -&gt; master slave definitions</span>
<span class="c1">#         - columns = 5 -&gt; channel-DOF assignments</span>
<span class="c1">#         for each removed row a signal is emited containg the removed values</span>
<span class="c1">#         so that they can be removed in any connected class, too</span>
<span class="c1">#         when removing a node, a check is performed on the other objects</span>
<span class="c1">#         if they are connected to this node and if yes they will be removed</span>
<span class="c1">#         as well</span>
<span class="c1">#         </span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         cols = self.coordinates_list.columnCount()</span>
<span class="c1">#         if rows is None:</span>
<span class="c1">#             items = self.coordinates_list.selectedItems()</span>
<span class="c1"># </span>
<span class="c1">#             rows = set() # avoid duplicate rows if more than one item in a row is selected</span>
<span class="c1">#             for item in items:</span>
<span class="c1">#                 rows.add(item.row())</span>
<span class="c1">#             rows = list(rows)</span>
<span class="c1">#             </span>
<span class="c1">#         rows.sort()</span>
<span class="c1">#         # removing from start would change numbering each time an item </span>
<span class="c1">#         # is removed, therefore reverse the list</span>
<span class="c1">#         rows.reverse() </span>
<span class="c1">#         for row in rows:</span>
<span class="c1">#             if row == -1: # no row selected</span>
<span class="c1">#                 continue</span>
<span class="c1"># </span>
<span class="c1">#             if cols == 4: # nodes</span>
<span class="c1">#                 node = int(self.coordinates_list.item(row, 0).text())</span>
<span class="c1">#                 x = float(self.coordinates_list.item(row, 1).text())</span>
<span class="c1">#                 y = float(self.coordinates_list.item(row, 2).text())</span>
<span class="c1">#                 z = float(self.coordinates_list.item(row, 3).text())</span>
<span class="c1">#                 self.coordinates_list.removeRow(row)</span>
<span class="c1"># </span>
<span class="c1">#                 while True: # check if any channel is assigned to this node</span>
<span class="c1">#                     for j, (chan, node_,  dof) in enumerate(self.chan_dofs):</span>
<span class="c1">#                         if node == node_:</span>
<span class="c1">#                             self.chan_dof_taken.emit(chan, node_, dof)</span>
<span class="c1">#                             del self.chan_dofs[j]</span>
<span class="c1">#                             break</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         break</span>
<span class="c1"># </span>
<span class="c1">#                 while True: # check if any line is connected to this node</span>
<span class="c1">#                     for j in range(len(self.lines)):</span>
<span class="c1">#                         line = self.lines[j]</span>
<span class="c1">#                         if node in line:</span>
<span class="c1">#                             self.line_taken.emit(line)</span>
<span class="c1">#                             del self.lines[j]</span>
<span class="c1">#                             break</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         break</span>
<span class="c1"># </span>
<span class="c1">#                 while True: # check if this node is a master or slave for another node</span>
<span class="c1">#                     for j, master_slave in enumerate(self.master_slaves):</span>
<span class="c1">#                         if node == master_slave[0] or node == master_slave[4]:</span>
<span class="c1">#                             m = master_slave</span>
<span class="c1">#                             self.slave_taken.emit(</span>
<span class="c1">#                                 m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7])</span>
<span class="c1">#                             del self.master_slaves[j]</span>
<span class="c1">#                             break</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         break</span>
<span class="c1">#                     </span>
<span class="c1">#                 self.node_taken.emit(x, y, z, node)</span>
<span class="c1"># </span>
<span class="c1">#                 if self.xs[node] == x:</span>
<span class="c1">#                     del self.xs[node]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;[i] does not correspond to i&#39;th &quot;</span>
<span class="c1">#                         &quot;element in coordinates list&quot;)</span>
<span class="c1">#                 if self.ys[node] == y:</span>
<span class="c1">#                     del self.ys[node]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;self.ys[i] does not correspond to i&#39;th &quot;</span>
<span class="c1">#                         &quot;element in coordinates list&quot;)</span>
<span class="c1">#                 if self.zs[node] == z:</span>
<span class="c1">#                     del self.zs[node]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;self.zs[i] does not correspond to i&#39;th &quot;</span>
<span class="c1">#                         &quot;element in coordinates list&quot;)</span>
<span class="c1"># </span>
<span class="c1">#             elif cols == 2:</span>
<span class="c1">#                 node_start = int(self.coordinates_list.item(row, 0).text())</span>
<span class="c1">#                 node_end = int(self.coordinates_list.item(row, 1).text())</span>
<span class="c1">#                 self.coordinates_list.removeRow(row)</span>
<span class="c1">#                 </span>
<span class="c1">#                 self.line_taken.emit((node_start, node_end))</span>
<span class="c1"># </span>
<span class="c1">#                 if self.lines[row] == (node_start, node_end):</span>
<span class="c1">#                     del self.lines[row]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;self.lines[i] does not correspond to i&#39;th element in coordinates list&quot;)</span>
<span class="c1"># </span>
<span class="c1">#             elif cols == 8:</span>
<span class="c1">#                 i_m = int(self.coordinates_list.item(row, 0).text())</span>
<span class="c1">#                 x_m = float(self.coordinates_list.item(row, 1).text())</span>
<span class="c1">#                 y_m = float(self.coordinates_list.item(row, 2).text())</span>
<span class="c1">#                 z_m = float(self.coordinates_list.item(row, 3).text())</span>
<span class="c1">#                 i_sl = int(self.coordinates_list.item(row, 4).text())</span>
<span class="c1">#                 x_sl = float(self.coordinates_list.item(row, 5).text())</span>
<span class="c1">#                 y_sl = float(self.coordinates_list.item(row, 6).text())</span>
<span class="c1">#                 z_sl = float(self.coordinates_list.item(row, 7).text())</span>
<span class="c1">#                 self.coordinates_list.removeRow(row)</span>
<span class="c1">#                 </span>
<span class="c1">#                 self.slave_taken.emit(</span>
<span class="c1">#                     i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl)</span>
<span class="c1"># </span>
<span class="c1">#                 if self.master_slaves[row] == [i_m, x_m, y_m, z_m, i_sl, x_sl, y_sl, z_sl]:</span>
<span class="c1">#                     del self.master_slaves[row]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;self.master_slaves[i] does not correspond to i&#39;th element in coordinates list&quot;)</span>
<span class="c1"># </span>
<span class="c1">#             elif cols == 5:</span>
<span class="c1">#                 chan = int(self.coordinates_list.item(row, 0).text())</span>
<span class="c1">#                 node = int(self.coordinates_list.item(row, 1).text())</span>
<span class="c1">#                 x_amp = float(self.coordinates_list.item(row, 2).text())</span>
<span class="c1">#                 y_amp = float(self.coordinates_list.item(row, 3).text())</span>
<span class="c1">#                 z_amp = float(self.coordinates_list.item(row, 4).text())</span>
<span class="c1">#                 self.coordinates_list.removeRow(row)</span>
<span class="c1">#                 </span>
<span class="c1">#                 self.chan_dof_taken.emit(</span>
<span class="c1">#                     chan, node, (x_amp, y_amp, z_amp))</span>
<span class="c1"># </span>
<span class="c1">#                 if self.chan_dofs[row][0] == chan and \</span>
<span class="c1">#                     self.chan_dofs[row][1] == node and \</span>
<span class="c1">#                     nearly_equal(self.chan_dofs[row][2][0],x_amp,3) and \</span>
<span class="c1">#                     nearly_equal(self.chan_dofs[row][2][1],y_amp,3) and \</span>
<span class="c1">#                     nearly_equal(self.chan_dofs[row][2][2],z_amp,3):</span>
<span class="c1">#                     </span>
<span class="c1">#                     del self.chan_dofs[row]</span>
<span class="c1">#                 else:</span>
<span class="c1">#                     print(</span>
<span class="c1">#                         &quot;self.chan_dofs[i] does not correspond to i&#39;th element in coordinates list&quot;)</span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def clear_list(self):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         convenience function to remove all rows in a list</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         rows = self.coordinates_list.rowCount()</span>
<span class="c1">#         self.remove_rows(list(range(rows)))   </span>
<span class="c1">#                         </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def close_return(self):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         function is used in load_lines, load_master_slave and load_chan_dof</span>
<span class="c1">#         if there are no nodes present load_* function will connect itself </span>
<span class="c1">#         to the return_to_func signal such that when the user is done</span>
<span class="c1">#         loading/creating the grid this close_return function is called,</span>
<span class="c1">#         which will hide the creation_widget for nodes and emit the </span>
<span class="c1">#         return_to_func signal, which will call the load_* function again</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         self.hide()</span>
<span class="c1">#         self.return_to_func.emit()</span>
<span class="c1"># </span>
<span class="c1"># </span>
<span class="c1">#     @pyqtSlot()</span>
<span class="c1">#     def save_file(self):</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         save the contents of the listwidget to a whitespace delimited</span>
<span class="c1">#         ascii file</span>
<span class="c1">#         &#39;&#39;&#39;</span>
<span class="c1">#         filename = QFileDialog.getSaveFileName(</span>
<span class="c1">#             caption=&#39;Save File&#39;, filter=&quot;*.asc&quot;, directory=self.last_path)</span>
<span class="c1">#         self.last_path = os.path.dirname(filename)</span>
<span class="c1">#         if filename == &quot;&quot;:</span>
<span class="c1">#             return</span>
<span class="c1">#         if not filename.endswith(&#39;.asc&#39;):</span>
<span class="c1">#             filename += &#39;.asc&#39;</span>
<span class="c1">#         with open(filename, &#39;w&#39;) as csvfile:</span>
<span class="c1">#             writer = csv.writer(csvfile, delimiter=&#39; &#39;)</span>
<span class="c1">#             for row in range(self.coordinates_list.rowCount()):</span>
<span class="c1">#                 row_list = []</span>
<span class="c1">#                 for column in range(self.coordinates_list.columnCount()):</span>
<span class="c1">#                     row_list.append(</span>
<span class="c1">#                         self.coordinates_list.item(row, column).text())</span>
<span class="c1">#                 writer.writerow(row_list)</span>

<div class="viewcode-block" id="start_msh_gui"><a class="viewcode-back" href="../classes/PlotMSH.html#PlotMSH.start_msh_gui">[docs]</a><span class="k">def</span> <span class="nf">start_msh_gui</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">msg_string</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="c1">#qInstallMessageHandler(handler)#suppress unimportant error msg</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;app&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">global</span> <span class="n">app</span>
        <span class="n">app</span><span class="o">=</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">):</span>
        <span class="n">app</span><span class="o">=</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">ModeShapeGUI</span><span class="p">(</span><span class="n">mode_shape_plot</span><span class="p">)</span>

    <span class="n">loop</span><span class="o">=</span><span class="n">QEventLoop</span><span class="p">()</span>
    <span class="n">form</span><span class="o">.</span><span class="n">destroyed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="c1">#FigureCanvasQTAgg.resize_event=old_resize_event</span>
    <span class="k">return</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Simon Marwitz, Volkmar Zabel, Andrei Udrea.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>